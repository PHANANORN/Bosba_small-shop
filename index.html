<!DOCTYPE html>
<html lang="km">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>My Shop - V70 Glassmorphism Full</title>
    <meta name="theme-color" content="#0F766E">

    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3081/3081559.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Battambang', 'sans-serif'],
                        serif: ['Noto Serif Khmer', 'serif'],
                    },
                    colors: {
                        light: { bg: '#F8FAFC', card: '#ffffff' },
                        dark: { bg: '#020617', card: '#1e293b' }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                        'glass-dark': '0 8px 32px 0 rgba(0, 0, 0, 0.3)',
                        'glow': '0 0 15px rgba(13, 148, 136, 0.4)'
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Noto+Serif+Khmer:wght@400;700&display=swap"
        rel="stylesheet">
    <style>
        /* === 1. SYSTEM & GLASS EFFECTS === */
        #app-loader {
            position: fixed;
            inset: 0;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(248, 250, 252, 0.92);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: opacity 0.5s ease;
        }

        .dark #app-loader {
            background: rgba(2, 6, 23, 0.92);
        }

        ::-webkit-scrollbar {
            display: none;
        }

        * {
            -ms-overflow-style: none;
            scrollbar-width: none;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        /* BACKGROUND AMBIENCE (To make glass effect visible) */
        body {
            font-family: 'Battambang', sans-serif;
            background-color: #F8FAFC;
            color: #334155;
            padding-bottom: 110px;
            overscroll-behavior-y: none;
            /* Subtle Gradient Mesh for Glass Effect Depth */
            background-image:
                radial-gradient(at 0% 0%, rgba(13, 148, 136, 0.08) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(99, 102, 241, 0.08) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.08) 0px, transparent 50%);
            background-attachment: fixed;
        }

        .dark body {
            background-color: #020617;
            color: #f8fafc;
            background-image:
                radial-gradient(at 0% 0%, rgba(13, 148, 136, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(236, 72, 153, 0.1) 0px, transparent 50%);
        }

        .font-serif-kh {
            font-family: 'Noto Serif Khmer', serif;
        }

        /* GLASSMORPHISM UTILITY */
        /* áŸ¡. á€áŸ‚á”áŸ’ášáŸ‚á•áŸ’á‘á¶áŸ†á„á€á‰áŸ’á…á€áŸ‹á‘á¼á‘áŸ… (Global Glass) */
        /* áŸ¡. á€áŸ‚á”áŸ’ášáŸ‚á•áŸ’á‘á¶áŸ†á„á€á‰áŸ’á…á€áŸ‹á‘á¼á‘áŸ… (Global Glass) */
        .glass-panel {
            background: rgba(255, 255, 255, 0.4) !important;
            /* ááŸ’á›á¶ 40% */
            backdrop-filter: blur(25px) saturate(200%) !important;
            -webkit-backdrop-filter: blur(25px) saturate(200%) !important;
            border: 1px solid rgba(255, 255, 255, 0.6) !important;
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1) !important;
        }

        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.4) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        /* === 2. HEADER ADJUSTMENTS === */
        .smart-header-anim {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 50;
            transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease;
        }

        .hide-ui {
            transform: translateY(-120%);
            opacity: 0;
            pointer-events: none;
        }

        .header-bg {
            background: linear-gradient(135deg, #0d9488, #14b8a6, #2dd4bf);
            background-size: 200% 200%;
            animation: gradientFlow 8s ease infinite;
            padding-top: max(15px, env(safe-area-inset-top));

            /* ADJUSTMENT 1: Increased padding-bottom to separate text from cards */
            padding-bottom: 135px;

            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px -5px rgba(13, 148, 136, 0.3);
            position: relative;
            z-index: 10;
            overflow: visible !important;
        }

        .dark .header-bg {
            background: linear-gradient(135deg, #0f172a, #1e293b, #115e59);
            box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.5);
        }

        @keyframes gradientFlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        @keyframes floatIcon {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-5px) rotate(5deg);
            }
        }

        .bg-deco-icon {
            position: absolute;
            opacity: 0.1;
            color: white;
            pointer-events: none;
            z-index: 0;
        }

        .deco-1 {
            top: 10%;
            left: 10%;
            font-size: 80px;
            transform: rotate(-15deg);
        }

        .deco-2 {
            bottom: 30%;
            right: -10%;
            font-size: 120px;
            transform: rotate(10deg);
        }

        .floating-stats-container {
            position: absolute;
            /* ADJUSTMENT 2: Moved cards further down relative to header bottom */
            bottom: -20px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            z-index: 100;
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* === GLASSY STAT CARDS === */
        .home-stat-card {
            flex: 1;
            /* GLASS EFFECT APPLIED */
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.1);

            border-radius: 24px;
            padding: 18px 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .dark .home-stat-card {
            background: rgba(30, 41, 59, 0.65);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.4);
        }

        .stat-label {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            opacity: 0.9;
        }

        .stat-value {
            font-size: 26px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .card-real .stat-label {
            color: #065f46;
        }

        .card-real .stat-value {
            color: #059669;
        }

        .card-pending .stat-label {
            color: #9a3412;
        }

        .card-pending .stat-value {
            color: #d97706;
        }

        .dark .card-real .stat-label,
        .dark .card-real .stat-value {
            color: #34d399;
            text-shadow: 0 0 20px rgba(52, 211, 153, 0.3);
        }

        .dark .card-pending .stat-label,
        .dark .card-pending .stat-value {
            color: #fbbf24;
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .card-icon-box {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 6px;
            font-size: 16px;
        }

        .icon-green {
            background: rgba(236, 253, 245, 0.8);
            color: #059669;
        }

        .icon-orange {
            background: rgba(255, 251, 235, 0.8);
            color: #d97706;
        }

        .dark .icon-green {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .dark .icon-orange {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .header-icon-btn {
            width: 38px;
            height: 38px;
            flex-shrink: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
            cursor: pointer;
            color: white;
            transition: transform 0.2s;
        }

        .header-icon-btn i {
            font-size: 16px;
            margin: 0;
        }

        .header-icon-btn:active {
            transform: scale(0.92);
            background: rgba(255, 255, 255, 0.3);
        }

        /* === 3. CONTENT & LISTS === */
        .main-content {
            padding: 0 16px;
            position: relative;
            z-index: 10;
            transition: margin-top 0.3s ease;
        }

        #view-home {
            margin-top: 300px;
            padding-bottom: 40px;
        }

        /* Adjusted for taller header */
        #view-reports {
            margin-top: 195px;
        }

        .search-box-container {
            position: sticky;
            top: 15px;
            z-index: 30;
            margin-bottom: 15px;
        }

        #report-header-container {
            display: none;
        }

        /* á”á“áŸ’ááŸ‚á˜áŸ– á€á»áŸ†á±áŸ’á™á–ááŸŒ Header á”á¶áŸ†á„ Background á‡á·áá–áŸá€ */
        .report-header-bg {
            background: rgba(255, 255, 255, 0.5) !important;
            backdrop-filter: blur(20px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.4) !important;
        }

        .dark .report-header-bg {
            background: rgba(15, 23, 42, 0.6) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .nav-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 90px;
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.05);
            display: grid;
            grid-template-columns: 1fr 1fr 70px 1fr 1fr;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 50;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.5);
        }

        .dark .nav-container {
            background: rgba(15, 23, 42, 0.85);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.3);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
            font-size: 11px;
            cursor: pointer;
            height: 100%;
            transition: all 0.2s;
        }

        .nav-item.active {
            color: #0f766e;
            font-weight: 700;
            transform: translateY(-4px);
        }

        .dark .nav-item.active {
            color: #2dd4bf;
        }

        .fab-wrapper {
            position: relative;
            top: -40px;
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 60;
        }

        .fab-button {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, #0d9488, #0f766e);
            border-radius: 50%;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            box-shadow: 0 10px 25px rgba(13, 148, 136, 0.4);
            cursor: pointer;
            transition: transform 0.2s;
            border: 4px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        .dark .fab-button {
            border-color: rgba(0, 0, 0, 0.2);
            box-shadow: 0 0 25px rgba(45, 212, 191, 0.3);
        }

        .fab-button:active {
            transform: scale(0.95);
        }

        /* ORDER CARD WITH GLASS EFFECT */
        /* === á€áŸ‚á”áŸ’ášáŸ‚ááŸ’ášá„áŸ‹á…áŸ†áá»á…á“áŸáŸ‡ áŠá¾á˜áŸ’á”á¸á±áŸ’á™áƒá¾á‰ Background áá¶á„á€áŸ’ášáŸ„á™ === */
        .order-card {
            /* á•áŸ’á‘áŸƒááŸ’á›á¶ááŸ’á›á¶áŸ†á„ (0.4 = 40% Opacity) áŠá¾á˜áŸ’á”á¸á±áŸ’á™áƒá¾á‰á–ááŸŒá”áŸ’ášáŠáŸá‰áá¶á„á€áŸ’ášáŸ„á™ */
            background: rgba(255, 255, 255, 0.4);

            /* á”á„áŸ’á€á¾á“ Blur áŠá¾á˜áŸ’á”á¸á±áŸ’á™á¢á€áŸ’áŸášá“áŸ…ááŸ‚á…áŸ’á”á¶áŸáŸ‹ á‘áŸ„áŸ‡á”á¸á•áŸ’á‘áŸƒá€áŸ’ášáŸ„á™ááŸ’á›á¶ */
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);

            /* á‚áŸ‚á˜á–ááŸŒáŸáŸáŸ’áŠá¾á„áŸ— áŠá¾á˜áŸ’á”á¸á€á¶ááŸ‹á”á“áŸ’áá™á—á¶á–ášá¶á”áŸáŸ’á˜á¾ */
            border: 1px solid rgba(255, 255, 255, 0.6);

            /* áŸáŸ’ášá˜áŸ„á›á‘á“áŸ‹áŸ— */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);

            border-radius: 24px;
            /* á˜á¼á›á‚áŸ‚á˜á±áŸ’á™áŸáŸ’á¢á¶á */
            margin-bottom: 16px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        /* Dark Mode áŸá˜áŸ’ášá¶á”áŸ‹ Crystal Card */
        .dark .order-card {
            background: rgba(30, 41, 59, 0.4);
            /* á–ááŸŒááŸ’á˜áŸ…ááŸ’á›á¶ */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Effect á–áŸá›á…á»á… */
        .order-card:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.6);
            /* á–áŸá›á…á»á…á±áŸ’á™á…áŸ’á”á¶áŸáŸ‹á”á“áŸ’áá·á… */
        }

        .card-strip {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            outline: none;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: #0d9488;
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.15);
            background: #fff;
        }

        .dark .input-field {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
            color: white;
        }

        .dark .input-field:focus {
            border-color: #2dd4bf;
            background: rgba(51, 65, 85, 0.8);
        }

        select#filter-dropdown option {
            background-color: #ffffff;
            color: #334155;
        }

        .dark select#filter-dropdown option {
            background-color: #1e293b;
            color: #ffffff;
        }

        /* Stat Card (Reports) Glass */
        /* áŸ¢. á€áŸ‚á”áŸ’ášáŸ‚á€á¶ááŸáŸ’áá·áá·á’áŸ†áŸ— (Stat Cards) */
        /* áŸ¢. á€áŸ‚á”áŸ’ášáŸ‚á€á¶ááŸáŸ’áá·áá·á’áŸ†áŸ— (Stat Cards) */
        /* áŸ¢. á€áŸ‚á”áŸ’ášáŸ‚á€á¶ááŸáŸ’áá·áá·á’áŸ†áŸ— (Stat Cards) */
        .stat-card {
            background: rgba(255, 255, 255, 0.35) !important;
            /* ááŸ’á›á¶á‡á¶á„á˜á»á“ */
            backdrop-filter: blur(20px) saturate(180%) !important;
            border-radius: 26px;
            padding: 18px;
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.05) !important;
            border: 1px solid rgba(255, 255, 255, 0.5) !important;
        }

        .dark .stat-card {
            background: rgba(30, 41, 59, 0.4) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .section-view {
            display: none;
        }

        .section-view.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Report Grid Items Glass */
        /* áŸ£. á€áŸ‚á”áŸ’ášáŸ‚á€á¶ááá¼á…áŸ— (Report Items) */
        /* áŸ£. á€áŸ‚á”áŸ’ášáŸ‚á€á¶ááá¼á…áŸ— (Report Items) */
        .report-item {
            background: rgba(255, 255, 255, 0.4) !important;
            /* ááŸ’á›á¶ááŸ’á›á¶áŸ†á„ */
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.4) !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05) !important;
        }

        .dark .report-item {
            background: rgba(15, 23, 42, 0.4) !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
        }

        .date-btn-active {
            background: linear-gradient(135deg, #0d9488, #0f766e) !important;
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.35);
        }

        .card-gradient-green {
            background: linear-gradient(135deg, rgba(236, 253, 245, 0.8) 0%, rgba(209, 250, 229, 0.8) 100%);
            border: 1px solid #a7f3d0;
        }

        .dark .card-gradient-green {
            background: linear-gradient(135deg, rgba(6, 78, 59, 0.6) 0%, rgba(6, 95, 70, 0.6) 100%);
            border: 1px solid #059669;
        }

        .modern-date-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 14px;
            padding: 12px 14px 12px 42px;
            font-size: 14px;
            font-weight: 700;
            color: #334155;
            border: 1px solid rgba(226, 232, 240, 0.8);
            outline: none;
            transition: all 0.2s;
            cursor: pointer;
        }

        .dark .modern-date-input {
            background: rgba(51, 65, 85, 0.5);
            border-color: #475569;
            color: white;
        }

        .date-icon-overlay {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            pointer-events: none;
            z-index: 10;
            font-size: 16px;
        }

        .dark .date-icon-overlay {
            color: #64748b;
        }

        .flatpickr-calendar {
            border-radius: 20px !important;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25) !important;
            border: none !important;
            font-family: 'Battambang', sans-serif !important;
            overflow: hidden !important;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(20px) !important;
        }

        .dark .flatpickr-calendar {
            background: rgba(30, 41, 59, 0.95) !important;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7) !important;
        }

        .flatpickr-months {
            background: #0F766E !important;
            padding: 15px 0 !important;
        }

        .flatpickr-current-month .flatpickr-monthDropdown-months,
        .flatpickr-current-month input.cur-year {
            color: #fff !important;
            font-weight: 900 !important;
            font-size: 18px !important;
        }

        .flatpickr-day.selected {
            background: #0F766E !important;
            border-color: #0F766E !important;
            box-shadow: 0 4px 10px rgba(15, 118, 110, 0.4) !important;
        }

        /* History Glass */
        .timeline-wrapper {
            position: relative;
            padding-left: 24px;
            padding-bottom: 30px;
        }

        .timeline-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 9px;
            width: 2px;
            background: linear-gradient(to bottom, #0f766e, #cbd5e1, transparent);
            z-index: 0;
        }

        .dark .timeline-wrapper::before {
            background: linear-gradient(to bottom, #0d9488, #334155, transparent);
        }

        .history-card-modern {
            background: rgba(255, 255, 255, 0.8);
            /* Glass */
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: transform 0.2s;
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.5s ease forwards;
        }

        .dark .history-card-modern {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .history-card-modern:active {
            transform: scale(0.98);
        }

        .history-dot {
            position: absolute;
            left: -22px;
            top: 22px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.2);
            z-index: 2;
        }

        .dark .history-dot {
            border-color: #0f172a;
        }

        .status-inc {
            border-left: 4px solid #10b981;
        }

        .status-exp {
            border-left: 4px solid #ef4444;
        }

        .status-pen {
            border-left: 4px solid #f97316;
        }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-150px);
            background: rgba(6, 78, 59, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: bold;
            z-index: 999999;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 2px solid #34D399;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* MODALS & Z-INDEX */
        #modal-order,
        #invoice-modal,
        #modal-trash,
        #modal-note {
            z-index: 9999;
        }

        #modal-confirm-overlay,
        #modal-import-overlay {
            z-index: 10000;
        }

        /* Glass Box for Modals */
        .glass-box {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(25px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 30px 60px -10px rgba(0, 0, 0, 0.2);
            border-radius: 24px;
        }

        .dark .glass-box {
            background: rgba(30, 41, 59, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* === á€áŸ‚á”áŸ’ášáŸ‚á•áŸ’á“áŸ‚á€á“áŸáŸ‡ === */
        /* === á€áŸ‚á”áŸ’ášáŸ‚á•áŸ’á“áŸ‚á€á“áŸáŸ‡á‘á¶áŸ†á„áŸáŸ’ášá»á„ (UPDATE PRINT CSS) === */
        /* === PROFESSIONAL BANK STATEMENT PRINT STYLE === */
        /* === FIX: REMOVE BROWSER HEADER/FOOTER & EXTRA PAGE === */
        /* === PREMIUM PROFESSIONAL STATEMENT DESIGN === */
        @media print {
            @page {
                size: A4;
                margin: 0;
            }

            html,
            body {
                width: 100%;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                background-color: white !important;
                visibility: hidden !important;
                -webkit-print-color-adjust: exact !important;
                /* á”á„áŸ’ááŸ†á±áŸ’á™ Print á…áŸá‰á–ááŸŒ Background */
                print-color-adjust: exact !important;
            }

            body * {
                visibility: hidden !important;
            }

            /* --- STATEMENT CONTAINER --- */
            body.printing-statement #print-area,
            body.printing-statement #print-area * {
                visibility: visible !important;
            }

            body.printing-statement #print-area {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                min-height: 100vh !important;
                padding: 12mm 15mm !important;
                /* Margin áŸáŸ’á¢á¶áá‡á»áŸ†áœá·á‰á€áŸ’ášáŠá¶áŸ */
                z-index: 999999 !important;
                background-color: white !important;
                display: block !important;
                font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
                /* Font á‘áŸ†á“á¾á” */
                color: #334155;
                /* á–ááŸŒá¢á€áŸ’áŸášá”áŸ’ášá•áŸáŸ‡á…á¶áŸáŸ‹ (á˜á¾á›á‘áŸ…ááŸ’á›áŸƒá‡á¶á„ááŸ’á˜áŸ…áŸá»á‘áŸ’á’) */
            }

            /* --- TABLE STYLING --- */
            body.printing-statement table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin-top: 25px !important;
                font-size: 11px !important;
            }

            body.printing-statement thead th {
                background-color: #f1f5f9 !important;
                /* á–ááŸŒá€áŸ’á”á¶á›áá¶ášá¶á„ */
                color: #475569 !important;
                text-transform: uppercase !important;
                letter-spacing: 1px !important;
                padding: 10px 8px !important;
                border-bottom: 2px solid #e2e8f0 !important;
                font-weight: 700 !important;
            }

            body.printing-statement tbody td {
                padding: 12px 8px !important;
                border-bottom: 1px solid #f1f5f9 !important;
                vertical-align: top !important;
            }

            body.printing-statement tbody tr:last-child td {
                border-bottom: none !important;
            }

            /* Zebra Striping (á‡á½ášá†áŸ’á›á¶áŸáŸ‹á–ááŸŒáŸáŸ’ášá¶á›áŸ—) */
            body.printing-statement tbody tr:nth-child(even) {
                background-color: #fafafa !important;
            }

            /* --- UTILITIES --- */
            .print-text-teal {
                color: #0d9488 !important;
            }

            .print-text-red {
                color: #ef4444 !important;
            }

            .print-bg-teal-light {
                background-color: #f0fdfa !important;
            }

            .print-border-top {
                border-top: 1px solid #e2e8f0 !important;
            }

            /* --- INVOICE SECTION (ášá€áŸ’áŸá¶á‘á»á€) --- */
            body.printing-invoice #invoice-modal {
                visibility: visible !important;
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                display: flex !important;
                justify-content: center !important;
                padding-top: 20mm !important;
            }

            body.printing-invoice #invoice-modal * {
                visibility: visible !important;
            }

            body.printing-invoice #invoice-modal>div {
                border: 1px solid #eee !important;
                width: 100% !important;
                max-width: 80mm !important;
            }

            body.printing-invoice #invoice-actions {
                display: none !important;
            }
        }

        /* === STICKER ANIMATIONS === */
        @keyframes float-sticker {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-6px) rotate(6deg);
            }

            /* á¢ááŸ’ááŸ‚áá¡á¾á„á”á“áŸ’áá·á… á á¾á™á„á¶á€á€áŸ’á”á¶á› */
        }

        @keyframes pulse-ring {
            0% {
                box-shadow: 0 0 0 0 rgba(13, 148, 136, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(13, 148, 136, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(13, 148, 136, 0);
            }
        }

        .sticker-float {
            animation: float-sticker 4s ease-in-out infinite;
            /* á¢ááŸ’ááŸ‚áá™áºááŸ— */
        }

        .sticker-pulse {
            animation: pulse-ring 2s infinite;
            /* á—á¶á™á–á“áŸ’á›áº */
        }
    </style>
</head>

<body>
    <div class="fixed inset-0 -z-50 overflow-hidden pointer-events-none">
        <div
            class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-teal-500/20 dark:bg-teal-500/10 rounded-full blur-[100px] animate-pulse-slow">
        </div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-500/20 dark:bg-purple-500/10 rounded-full blur-[100px] animate-pulse-slow"
            style="animation-delay: 2s;"></div>
        <div
            class="absolute top-[40%] left-[40%] w-[300px] h-[300px] bg-blue-400/10 dark:bg-blue-400/5 rounded-full blur-[80px]">
        </div>
    </div>
    <div id="app-loader">
        <div class="text-center">
            <div class="relative w-16 h-16 mx-auto mb-4">
                <div class="absolute inset-0 border-4 border-gray-200 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-teal-600 rounded-full border-t-transparent animate-spin">
                </div>
            </div>
            <p id="loader-text" class="text-teal-700 dark:text-teal-400 font-bold text-lg animate-pulse">
                á€áŸ†á–á»á„áŠáŸ†áá¾ášá€á¶áš...</p>
        </div>
    </div>

    <div id="toast" class="toast"><i class="fas fa-check-circle text-yellow-300 text-lg"></i><span
            id="toast-msg">ášá€áŸ’áŸá¶á‘á»á€á‡áŸ„á‚á‡áŸá™!</span></div>

    <div id="print-area" class="hidden font-sans text-gray-800">
        <div class="flex justify-between items-start border-b-2 border-teal-600 pb-6 mb-6">
            <div>
                <h1 class="text-3xl font-bold text-teal-700 uppercase tracking-widest mb-1">Statement</h1>
                <p class="text-sm font-serif-kh text-gray-500">ášá”á¶á™á€á¶ášááŸá¢á¶á‡á¸áœá€á˜áŸ’á˜</p>
                <div class="mt-4 text-xs text-gray-500 leading-relaxed">
                    <strong>MY SMALL SHOP</strong><br>
                    Phnom Penh, Cambodia<br>
                    System Generated Report
                </div>
            </div>
            <div class="text-right">
                <div class="bg-gray-100 px-4 py-2 rounded mb-2">
                    <p class="text-xs text-gray-500 uppercase">Period / á€á¶á›á”ášá·á…áŸ’á†áŸá‘</p>
                    <p class="text-sm font-bold text-gray-800" id="print-date-range">...</p>
                </div>
                <p class="text-xs text-gray-400 mt-1">Printed: <span id="print-gen-date"></span></p>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-8">
            <div class="print-summary-box">
                <div class="text-xs text-gray-500 uppercase mb-1">Total Sales (á…áŸ†áá¼á›áŸášá»á”)</div>
                <div class="text-xl font-bold text-teal-700" id="print-total-sales">$0.00</div>
            </div>
            <div class="print-summary-box">
                <div class="text-xs text-gray-500 uppercase mb-1">Total Expenses (á…áŸ†áá¶á™áŸášá»á”)</div>
                <div class="text-xl font-bold text-red-500" id="print-total-exp">$0.00</div>
            </div>
            <div class="print-summary-box" style="background-color: #f0fdf4; border-color: #bbf7d0;">
                <div class="text-xs text-teal-600 uppercase mb-1">Net Profit (á…áŸ†ááŸá‰áŸá»á‘áŸ’á’)</div>
                <div class="text-xl font-bold text-teal-800" id="print-net-profit">$0.00</div>
            </div>
        </div>

        <table class="w-full">
            <thead>
                <tr>
                    <th class="text-left w-24">Date</th>
                    <th class="text-left">Customer</th>
                    <th class="text-left">Product</th>
                    <th class="text-center w-12">Qty</th>
                    <th class="text-right w-20">Cost</th>
                    <th class="text-right w-20">Sale</th>
                    <th class="text-right w-20">Profit</th>
                </tr>
            </thead>
            <tbody id="print-table-body">
            </tbody>
        </table>

        <div class="mt-8 pt-8 border-t border-gray-200 text-center text-xs text-gray-400">
            <p>End of Statement</p>
            <p class="mt-1 opacity-70">Professional Report generated by My Small Shop Tracker</p>
        </div>
    </div>

    <div id="modal-note"
        class="hidden fixed inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm p-6 animate-fade-in">
        <div class="glass-box w-full max-w-xs rounded-3xl p-6 relative transform transition-all scale-100 shadow-2xl">
            <div
                class="flex justify-between items-center mb-4 border-b border-dashed border-gray-200 dark:border-gray-600 pb-3">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white font-serif-kh flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center"><i
                            class="fas fa-sticky-note text-sm"></i></div>
                    á€á¶ášá€ááŸ‹á…áŸ†áá¶áŸ†
                </h3>
                <button onclick="document.getElementById('modal-note').classList.add('hidden')"
                    class="w-8 h-8 rounded-full bg-gray-50 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-300 hover:bg-red-50 hover:text-red-500 transition"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="text-gray-700 dark:text-gray-300 text-sm leading-relaxed font-sans bg-transparent min-h-[50px]">
                <p id="note-content-display"></p>
            </div>
        </div>
    </div>

    <div id="home-header-container" class="smart-header-anim">
        <header class="header-bg text-white">

            <i class="fas fa-store bg-deco-icon deco-1"></i>
            <i class="fas fa-wallet bg-deco-icon deco-2"></i>

            <div class="px-5 pt-3 flex justify-between items-start relative z-20">
                <button onclick="ui.toggleTheme()" class="header-icon-btn">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </button>

                <div id="header-home-title" class="flex-1 text-center px-2 z-20 pt-1">
                    <div class="relative inline-block mb-3"> <i
                            class="fas fa-shop absolute -right-6 -top-4 text-teal-200 text-2xl drop-shadow-md"
                            style="animation: floatIcon 4s ease-in-out infinite;"></i>

                        <h1
                            class="whitespace-nowrap text-[clamp(14px,4.5vw,20px)] font-extrabold font-serif-kh tracking-wide drop-shadow-lg leading-tight text-white">
                            MY SMALL SHOP TRACKER
                        </h1>
                        <p class="text-[11px] text-teal-50 font-bold tracking-widest mt-1 opacity-90">
                            Professional by NornğŸ¤£
                        </p>
                    </div>
                </div>

                <button onclick="dataManager.downloadBackup()" class="header-icon-btn">
                    <i class="fas fa-cloud-download-alt"></i>
                </button>
            </div>

            <div class="floating-stats-container">
                <div class="home-stat-card card-real">
                    <div class="card-icon-box icon-green">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <span class="stat-label">á…áŸ†ááŸá‰á‡á¶á€áŸ‹áŸáŸ’áŠáŸ‚á„</span>
                    <h2 class="stat-value" id="dash-real-profit">$0.00</h2>
                </div>

                <div class="home-stat-card card-pending">
                    <div class="card-icon-box icon-orange">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                    <span class="stat-label">á…áŸ†ááŸá‰ášáŸ†á–á¹á„á‘á»á€</span>
                    <h2 class="stat-value" id="dash-pending-profit">$0.00</h2>
                </div>
            </div>
        </header>
    </div>
    <div id="report-header-container" class="smart-header-anim">
        <div class="report-header-bg">
            <h2
                class="text-lg font-bold text-teal-700 dark:text-teal-400 font-serif-kh pl-1 flex items-center gap-2 drop-shadow-sm mb-3">
                <i class="fas fa-chart-line"></i> ášá”á¶á™á€á¶ášááŸ
            </h2>
            <div class="flex items-center gap-2 mb-2">
                <div class="relative flex-1 group">
                    <i class="far fa-calendar-alt date-icon-overlay"></i>
                    <input type="text" id="date-start" class="modern-date-input" placeholder="á…á¶á”áŸ‹á–á¸">
                </div>
                <div class="text-gray-400"><i class="fas fa-arrow-right"></i></div>
                <div class="relative flex-1 group">
                    <i class="far fa-calendar-check date-icon-overlay"></i>
                    <input type="text" id="date-end" class="modern-date-input" placeholder="áŠá›áŸ‹">
                </div>
            </div>
            <div class="grid grid-cols-4 gap-2">
                <button id="btn-today" onclick="ui.setReportDate('today')"
                    class="date-filter-btn py-2 rounded-lg text-[10px] font-bold border active:scale-95 transition shadow-sm">ááŸ’á„áŸƒá“áŸáŸ‡</button>
                <button id="btn-yesterday" onclick="ui.setReportDate('yesterday')"
                    class="date-filter-btn py-2 rounded-lg text-[10px] font-bold border active:scale-95 transition shadow-sm">á˜áŸ’áŸá·á›á˜á·á‰</button>
                <button id="btn-thisWeek" onclick="ui.setReportDate('thisWeek')"
                    class="date-filter-btn py-2 rounded-lg text-[10px] font-bold border active:scale-95 transition shadow-sm">áŸá”áŸ’áŠá¶á áŸá“áŸáŸ‡</button>
                <button id="btn-thisMonth" onclick="ui.setReportDate('thisMonth')"
                    class="date-filter-btn py-2 rounded-lg text-[10px] font-bold border active:scale-95 transition shadow-sm">ááŸ‚á“áŸáŸ‡</button>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div id="view-home" class="section-view active">
            <div class="px-1 mb-3">
                <div id="statusFilterBtn"
                    class="bg-white/60 dark:bg-slate-800/60 backdrop-blur-md border border-white/50 dark:border-slate-700/50 px-5 py-3.5 rounded-2xl shadow-sm flex justify-between items-center cursor-pointer mb-4 hover:bg-white/80 dark:hover:bg-slate-800/80 transition-all z-30 relative">
                    <div class="flex items-center gap-3 text-gray-700 dark:text-gray-200 font-medium">
                        <svg class="w-5 h-5 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z">
                            </path>
                        </svg>
                        <span id="currentStatusText"
                            class="text-[15px] font-semibold text-gray-700 dark:text-gray-200">ğŸ“„ á”á„áŸ’á á¶á‰á‘á¶áŸ†á„á¢áŸáŸ‹
                            (All)</span>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 dark:text-gray-500" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
            </div>
            <div class="search-box-container px-1">
                <div class="relative glass-panel rounded-2xl shadow-glass dark:shadow-glass-dark">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i
                            class="fas fa-search text-gray-400 text-lg"></i></div>
                    <input type="text" id="search-input" onkeyup="ui.renderHome()"
                        class="pl-10 input-field rounded-2xl border-none h-14 text-base bg-transparent"
                        placeholder="áŸáŸ’áœáŸ‚á„ášá€áˆáŸ’á˜áŸ„áŸ‡, á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘...">
                </div>
            </div>
            <div id="order-list" class="pb-10">
                <div class="text-center mt-10 text-gray-400 text-sm">á€áŸ†á–á»á„á•áŸ’á‘á»á€á‘á·á“áŸ’á“áŸá™...</div>
            </div>
        </div>

        <div id="view-reports" class="section-view">
            <div id="report-content" class="animate-fade-in glass-panel rounded-3xl p-1 mb-6">

                <div
                    class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl p-5 text-white mb-5 shadow-lg relative overflow-hidden">
                    <div
                        class="absolute right-[-20px] top-[-20px] text-[100px] text-white opacity-10 pointer-events-none">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="relative z-10">
                        <h3
                            class="text-xs font-bold uppercase tracking-widest opacity-80 mb-3 border-b border-white/20 pb-2">
                            áŸášá»á”á–á¸á˜á»á“á˜á€ (Lifetime Overview)</h3>
                        <div class="flex justify-between items-end">
                            <div>
                                <div class="text-[10px] opacity-90 mb-1">á”áŸ’ášá¶á€áŸ‹á…áŸ†ááŸá‰áŸášá»á”</div>
                                <div class="text-3xl font-bold text-white" id="lbl-lifetime-profit">$0.00</div>
                            </div>
                            <div class="text-right">
                                <div class="text-[10px] opacity-90 mb-1">á…áŸ†á“á½á“á›á€áŸ‹áŸášá»á”</div>
                                <div class="text-xl font-bold text-white" id="lbl-lifetime-orders">0</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="px-2 mb-2 text-xs font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2">
                    <i class="fas fa-filter"></i> á‘á·á“áŸ’á“áŸá™áá¶á˜á€á¶á›á”ášá·á…áŸ’á†áŸá‘
                </div>

                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="report-item card-gradient-green relative overflow-hidden">
                        <div class="absolute right-[-10px] top-[-10px] text-6xl text-emerald-500 opacity-10"><i
                                class="fas fa-coins"></i></div>
                        <div
                            class="text-xs text-emerald-700 dark:text-emerald-200 font-bold uppercase mb-1 z-10 relative">
                            <span
                                class="text-xs sm:text-sm text-emerald-700 dark:text-emerald-200 font-bold uppercase mb-1 z-10 relative leading-tight block">á…áŸ†ááŸá‰
                                (Net Profit)</span>
                        </div>
                        <div class="text-2xl sm:text-3xl font-bold text-emerald-800 dark:text-white z-10 relative"
                            id="rpt-net-profit">$0.00</div>
                        <div id="rpt-pending-note"></div>
                    </div>
                    <div
                        class="report-item relative overflow-hidden bg-blue-50 dark:bg-blue-900/20 border-blue-100 dark:border-blue-800">
                        <div class="absolute right-[-10px] top-[-10px] text-6xl text-blue-500 opacity-10"><i
                                class="fas fa-shopping-cart"></i></div>
                        <div class="text-xs text-blue-600 dark:text-blue-300 font-bold uppercase mb-1 z-10 relative">
                            <span
                                class="text-xs sm:text-sm text-blue-600 dark:text-blue-300 font-bold uppercase mb-1 z-10 relative leading-tight block">á…áŸ†á“á½á“á›á€áŸ‹
                                (Orders)</span>
                        </div>
                        <div class="text-2xl sm:text-3xl font-bold text-blue-800 dark:text-white z-10 relative"
                            id="rpt-order-count">0</div>
                    </div>
                </div>

                <div class="stat-card mb-4 !p-5">
                    <h3
                        class="font-bold text-gray-800 dark:text-white text-sm mb-4 border-b border-gray-100 dark:border-gray-700 pb-2 flex items-center justify-between">
                        <span>á…áŸ†áá¼á› & á…áŸ†áá¶á™ (áá¶á˜á€á¶ášá‡áŸ’ášá¾áŸášá¾áŸ)</span>
                        <span
                            class="text-xs bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded text-gray-500">Details</span>
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500 dark:text-gray-400 font-medium">á…áŸ†áá¼á›áŸášá»á” (Sales)</span>
                            <span class="font-bold text-teal-600 dark:text-teal-400" id="rpt-total-income">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500 dark:text-gray-400 font-medium">á—áŸ’á‰áŸ€áœá…áŸá‰ááŸ’á›áŸƒáŠá¹á€</span>
                            <span class="font-bold text-gray-700 dark:text-gray-300" id="rpt-shipping-in">$0.00</span>
                        </div>
                        <hr class="border-dashed border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500 dark:text-gray-400 font-medium">ááŸ’á›áŸƒáŠá¾á˜á‘áŸ†á“á·á‰ (COGS)</span>
                            <span class="font-bold text-red-500" id="rpt-cogs-total">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500 dark:text-gray-400 font-medium">á…áŸ†áá¶á™ááŸ’á›áŸƒáŠá¹á€</span>
                            <span class="font-bold text-red-400" id="rpt-ship-exp">$0.00</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-500 dark:text-gray-400 font-medium">á…áŸ†áá¶á™ Ads/Boost</span>
                            <span class="font-bold text-red-400" id="rpt-ads-total">$0.00</span>
                        </div>
                        <div
                            class="bg-gray-50 dark:bg-gray-800 rounded-xl p-3 mt-2 flex justify-between items-center border border-gray-100 dark:border-gray-700">
                            <span class="text-xs font-bold text-gray-500 uppercase">Margin %</span>
                            <span class="text-sm font-bold text-blue-600 dark:text-blue-400" id="rpt-margin">0%</span>
                        </div>
                    </div>
                </div>

                <div class="stat-card mb-4 !p-0 overflow-hidden">
                    <div
                        class="p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 flex justify-between items-center">
                        <h3 class="font-bold text-gray-800 dark:text-white text-sm">ğŸ”¥ á‘áŸ†á“á·á‰á›á€áŸ‹áŠá¶á…áŸ‹ (Top 5)</h3>
                        <i class="fas fa-crown text-yellow-500 text-xs"></i>
                    </div>
                    <div id="top-products-list" class="divide-y divide-gray-100 dark:divide-gray-700">
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-8">
                <button onclick="ui.generatePDFStatement()"
                    class="py-3.5 bg-red-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-red-200 dark:shadow-none hover:bg-red-700 active:scale-95 transition flex items-center justify-center gap-2 col-span-2">
                    <i class="fas fa-file-pdf"></i> Download PDF Statement (A4)
                </button>
                <button onclick="ui.exportReportCSV()"
                    class="py-3.5 bg-green-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-green-200 dark:shadow-none hover:bg-green-700 active:scale-95 transition flex items-center justify-center gap-2">
                    <i class="fas fa-file-excel"></i> Export Excel
                </button>
                <button onclick="ui.shareReportText()"
                    class="py-3.5 bg-blue-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-blue-200 dark:shadow-none hover:bg-blue-700 active:scale-95 transition flex items-center justify-center gap-2">
                    <i class="fas fa-copy"></i> Copy Text
                </button>
            </div>
        </div>

        <div id="view-history" class="section-view pt-24 pb-24 px-4">
            <div class="flex justify-between items-end mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white font-serif-kh">á”áŸ’ášáœááŸ’áá·á”áŸ’ášáá·á”ááŸ’áá·á€á¶áš
                    </h2>
                    <p class="text-xs text-gray-500 mt-1">á”á‰áŸ’á‡á¸á…áŸ†áá¼á› á“á·á„á…áŸ†áá¶á™á›á˜áŸ’á¢á·á</p>
                </div>
                <div class="bg-teal-50 dark:bg-teal-900/30 px-3 py-1 rounded-lg">
                    <span class="text-xs font-bold text-teal-700 dark:text-teal-400" id="hist-total-count">0
                        á”áŸ’ášáá·á”ááŸ’áá·á€á¶áš</span>
                </div>
            </div>
            <div id="history-list-container">
            </div>
        </div>

        <div id="view-settings" class="section-view pt-5">
            <h2 class="text-xl font-bold text-gray-800 dark:text-gray-100 mb-4 pl-1 font-serif-kh">á€á¶ášá€áŸ†áááŸ‹</h2>
            <div class="mb-6 mt-4 relative group">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-teal-400 to-blue-500 rounded-2xl blur opacity-20 group-hover:opacity-30 transition duration-500">
                </div>

                <div
                    class="relative bg-white/60 dark:bg-slate-800/60 backdrop-blur-xl border border-white/50 dark:border-white/10 p-5 rounded-2xl shadow-xl">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="font-bold text-gray-800 dark:text-white text-lg flex items-center gap-2">
                                <span
                                    class="w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 to-orange-500 text-white flex items-center justify-center shadow-md"><i
                                        class="fas fa-coins text-sm"></i></span>
                                á¢ááŸ’ášá¶á”áŸ’áŠá¼ášá”áŸ’ášá¶á€áŸ‹
                            </h3>
                            <p class="text-[10px] text-gray-500 dark:text-gray-400 mt-1 pl-10">
                                á¢ááŸ’ášá¶áŠáŸ‚á›á”áŸ’ášá¾áŸá˜áŸ’ášá¶á”áŸ‹á‚áá“á¶á”áŸ’ášá¶á€áŸ‹á…áŸ†ááŸá‰áŸášá»á”</p>
                        </div>

                        <label class="flex flex-col items-center cursor-pointer relative gap-1">
                            <input type="checkbox" id="sys-rate-mode" onchange="ui.toggleSysRateMode()"
                                class="sr-only peer">
                            <div
                                class="w-12 h-6 bg-gray-300 dark:bg-gray-600 rounded-full peer peer-checked:bg-gradient-to-r peer-checked:from-teal-400 peer-checked:to-teal-600 peer-focus:outline-none after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:shadow-sm after:transition-all peer-checked:after:translate-x-full">
                            </div>
                            <span
                                class="text-[9px] font-bold text-gray-400 peer-checked:text-teal-600 uppercase tracking-widest">Auto</span>
                        </label>
                    </div>

                    <div
                        class="flex items-end justify-between bg-white dark:bg-gray-900/50 rounded-xl p-3 border border-gray-100 dark:border-gray-700/50">
                        <div>
                            <span
                                class="text-[10px] text-gray-400 font-bold uppercase tracking-wider block mb-1">áá˜áŸ’á›áŸƒá”á…áŸ’á…á»á”áŸ’á”á“áŸ’á“
                                (Current Rate)</span>
                            <div class="flex items-baseline gap-1">
                                <span class="text-lg font-bold text-gray-500 dark:text-gray-400">$1 = </span>
                                <input type="number" inputmode="numeric" id="sys-rate-input"
                                    onchange="ui.updateSysRate(this.value)"
                                    class="w-24 bg-transparent border-b-2 border-teal-500 text-2xl font-black text-teal-600 dark:text-teal-400 outline-none text-center focus:border-blue-500 transition px-1"
                                    value="4100">
                                <span class="text-sm font-bold text-gray-500 dark:text-gray-400">áŸ›</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-[9px] text-gray-400 mb-1">Status</div>
                            <div id="rate-status-badge"
                                class="px-2 py-1 bg-green-100 text-green-700 text-[10px] font-bold rounded-lg inline-flex items-center gap-1">
                                <i class="fas fa-check-circle"></i> Active
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="stat-card mb-6">
                <h3 class="font-bold text-gray-700 dark:text-gray-300 text-base mb-4 flex items-center gap-2"><i
                        class="fas fa-database text-teal-600 dark:text-teal-400"></i> á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á‘á·á“áŸ’á“áŸá™ (Data Management)
                </h3>

                <div class="space-y-3 mb-4">
                    <button onclick="dataManager.downloadBackup()"
                        class="w-full py-4 bg-teal-600 text-white rounded-xl text-sm font-bold shadow-lg shadow-teal-200 dark:shadow-none hover:bg-teal-700 active:scale-95 transition flex items-center justify-center">
                        <i class="fas fa-download mr-2 text-lg"></i>
                        ášá€áŸ’áŸá¶á‘á»á€á¯á€áŸá¶áš (Download JSON Backup)
                    </button>

                    <div class="grid grid-cols-2 gap-3">
                        <label
                            class="w-full flex items-center justify-center py-4 bg-blue-50 dark:bg-gray-800 text-blue-700 dark:text-blue-400 border border-blue-100 dark:border-gray-700 rounded-xl text-sm font-bold cursor-pointer active:bg-blue-100 transition text-center hover:bg-blue-100">
                            <i class="fas fa-file-import mr-2"></i> áŠá¶á€áŸ‹á…á¼á› (Import)<br><span
                                class="text-[10px] opacity-70">(JSON or Excel/CSV)</span>
                            <input type="file" id="import-input" onchange="dataManager.prepareImport(this)"
                                class="hidden" accept=".json, .csv">
                        </label>
                        <button onclick="dataManager.exportCSV()"
                            class="py-4 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border border-green-200 dark:border-green-800 rounded-xl text-sm font-bold active:bg-green-100 hover:bg-green-100">
                            <i class="fas fa-file-excel mr-2"></i> á”á‰áŸ’á…áŸá‰ Excel (All)
                        </button>
                    </div>
                </div>

                <div
                    class="p-3 bg-yellow-50 dark:bg-yellow-900/10 rounded-xl border border-yellow-100 dark:border-yellow-800 text-xs text-yellow-700 dark:text-yellow-400 mb-4">
                    <i class="fas fa-info-circle mr-1"></i> <b>á…áŸ†áá¶áŸ†áŸ–</b> á˜á»áá„á¶áš Import á¢á¶á…á‘á‘á½á›á¯á€áŸá¶áš <b>.JSON</b> (á–á¸
                    Backup) á“á·á„ <b>.CSV</b> (á–á¸ Excel) á”á¶á“á‘á¶áŸ†á„á¢áŸáŸ‹áŸ” áŸá¼á˜á’áŸ’áœá¾á€á¶áš BACKUP á˜á»á“á›á»á”á€á˜áŸ’á˜áœá·á’á¸
                    á¬á•áŸ’á›á¶áŸáŸ‹á”áŸ’áŠá¼ášá‘á¼ášáŸáŸá–áŸ’á‘áŸ”
                </div>
            </div>

            <div class="stat-card mb-8 p-0 overflow-hidden">
                <div class="p-5 flex justify-between items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition"
                    onclick="ui.openTrashModal(true)">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 text-red-500 flex items-center justify-center">
                            <i class="fas fa-trash-alt text-base"></i>
                        </div><span class="text-base font-bold text-gray-600 dark:text-gray-300">á’á»á„áŸáŸ†ášá¶á˜ (Trash
                            Bin)</span>
                    </div><i class="fas fa-chevron-right text-gray-300"></i>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 text-center">
                <button onclick="dataManager.resetApp()"
                    class="text-sm font-bold text-red-500 bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/30 px-6 py-4 rounded-xl hover:bg-red-100 transition w-full">
                    <i class="fas fa-exclamation-triangle mr-1"></i> á›á»á”á…áŸ„á›á‘á·á“áŸ’á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹ (Reset)
                </button>
            </div>
        </div>
    </main>

    <div class="nav-container glass-panel">
        <div class="nav-item active" onclick="ui.switchTab('home')"><i
                class="fas fa-home text-lg"></i><span>á‘áŸ†á–áŸášáŠá¾á˜</span></div>
        <div class="nav-item" onclick="ui.switchTab('reports')"><i
                class="fas fa-chart-pie text-lg"></i><span>áŸáŸ’áá·áá·</span></div>
        <div class="fab-wrapper">
            <div class="fab-button" onclick="ui.openOrderModal()"><i class="fas fa-plus"></i></div>
        </div>
        <div class="nav-item" onclick="ui.switchTab('history')"><i
                class="fas fa-history text-lg"></i><span>á”áŸ’ášáœááŸ’áá·</span></div>
        <div class="nav-item" onclick="ui.switchTab('settings')"><i class="fas fa-cog text-lg"></i><span>á€áŸ†áááŸ‹</span>
        </div>
    </div>

    <style>
        /* Custom Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animation for Title */
        @keyframes shine {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .animate-shine {
            background-size: 200% auto;
            animation: shine 4s ease infinite;
        }
    </style>
    <style>
        /* === 4K OLED GLASS EFFECT === */
        .oled-glass-bg {
            /* á•áŸ’á‘áŸƒáá¶á„á€áŸ’ášáŸ„á™á€á‰áŸ’á…á€áŸ‹á‚á»áá—á¶á–ááŸ’á–áŸáŸ‹ */
            background: rgba(255, 255, 255, 0.70);
            /* á€á¶ááŸ‹á”á“áŸ’áá™á—á¶á–áŸáŸ’ášá¢á¶á”áŸ‹ */
            backdrop-filter: blur(40px) saturate(200%) contrast(110%);
            /* á”á„áŸ’á€á¾á“ Saturation & Contrast á±áŸ’á™á…áŸ’á”á¶áŸáŸ‹ */
            -webkit-backdrop-filter: blur(40px) saturate(200%) contrast(110%);
            border: 1px solid rgba(255, 255, 255, 0.6);
            /* á‚áŸ‚á˜á…áŸ’á”á¶áŸáŸ‹ */
            border-top: 1px solid rgba(255, 255, 255, 0.9);
            /* á‚áŸ‚á˜áá¶á„á›á¾á—áŸ’á›áºá‡á¶á„ (á–á“áŸ’á›áºá…á¶áŸ†á„) */
            box-shadow:
                0 20px 50px -12px rgba(0, 0, 0, 0.15),
                /* áŸáŸ’ášá˜áŸ„á›á’áŸ† */
                inset 0 0 0 1px rgba(255, 255, 255, 0.2);
            /* áŸáŸ’ášá˜áŸ„á›áá¶á„á€áŸ’á“á»á„ */
        }

        .dark .oled-glass-bg {
            background: rgba(15, 23, 42, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
        }

        /* á€á¶ááá¶á„á€áŸ’á“á»á„ (Inner Cards) */
        .crystal-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 255, 0.4) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.05);
        }

        .dark .crystal-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.5) 0%, rgba(15, 23, 42, 0.4) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* Input Fields áŠáŸ‚á›á…áŸ’á”á¶áŸáŸ‹á›áŸ’á¢ */
        .oled-input {
            background: rgba(255, 255, 255, 0.6) !important;
            border: 1px solid rgba(203, 213, 225, 0.6) !important;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.02);
        }

        .oled-input:focus {
            background: rgba(255, 255, 255, 0.95) !important;
            border-color: #0d9488 !important;
            box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.15), inset 0 1px 2px rgba(0, 0, 0, 0.05);
            transform: translateY(-1px);
        }

        .dark .oled-input {
            background: rgba(15, 23, 42, 0.6) !important;
            border-color: rgba(71, 85, 105, 0.6) !important;
            color: white !important;
        }

        .dark .oled-input:focus {
            background: rgba(30, 41, 59, 0.9) !important;
        }
    </style>

    <div id="modal-order"
        class="fixed inset-0 bg-slate-900/40 dark:bg-black/80 z-50 hidden flex items-end sm:items-center justify-center backdrop-blur-[8px] transition-all duration-300">

        <div
            class="relative w-full sm:w-[480px] h-[92vh] sm:h-[85vh] rounded-t-[40px] sm:rounded-[40px] overflow-hidden animate-slide-up flex flex-col oled-glass-bg">

            <div
                class="absolute top-[-10%] left-[-10%] w-[200px] h-[200px] bg-teal-400/30 rounded-full blur-[80px] pointer-events-none">
            </div>
            <div
                class="absolute bottom-[-10%] right-[-10%] w-[200px] h-[200px] bg-purple-400/30 rounded-full blur-[80px] pointer-events-none">
            </div>

            <div
                class="flex justify-between items-center px-5 py-4 z-20 shrink-0 border-b border-white/40 dark:border-white/5 bg-white/30 dark:bg-black/20 backdrop-blur-xl">
                <div class="flex items-center overflow-hidden ml-4">
                    <div class="min-w-0 flex flex-col justify-center">
                        <h3 class="text-xl font-black font-serif-kh tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-teal-800 to-blue-800 dark:from-white dark:to-teal-200 drop-shadow-sm whitespace-nowrap overflow-hidden text-ellipsis leading-tight"
                            id="modal-title">
                            á€á¶ášá›á€áŸ‹ááŸ’á˜á¸
                        </h3>
                        <p class="text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase tracking-[0.15em] opacity-80 truncate leading-tight mt-0.5"
                            id="modal-subtitle">
                            CREATE NEW ORDER
                        </p>
                    </div>
                </div>

                <div class="flex gap-2 shrink-0">
                    <div id="invoice-btn-group" class="hidden gap-2">
                        <button onclick="ui.openInvoice('customer')"
                            class="w-9 h-9 rounded-full bg-blue-50/80 text-blue-600 dark:bg-blue-900/50 dark:text-blue-300 flex items-center justify-center border border-white/60 dark:border-white/10 shadow-sm active:scale-95 transition backdrop-blur-md"><i
                                class="fas fa-file-invoice text-xs"></i></button>
                        <button onclick="ui.openInvoice('admin')"
                            class="w-9 h-9 rounded-full bg-purple-50/80 text-purple-600 dark:bg-purple-900/50 dark:text-purple-300 flex items-center justify-center border border-white/60 dark:border-white/10 shadow-sm active:scale-95 transition backdrop-blur-md"><i
                                class="fas fa-user-shield text-xs"></i></button>
                    </div>
                    <button onclick="ui.shareTextOrder()"
                        class="w-9 h-9 rounded-full bg-teal-50/80 text-teal-600 dark:bg-teal-900/50 dark:text-teal-300 flex items-center justify-center border border-white/60 dark:border-white/10 shadow-sm active:scale-95 transition backdrop-blur-md"><i
                            class="fas fa-share-alt text-xs"></i></button>
                    <button onclick="ui.closeModal('modal-order')"
                        class="w-9 h-9 rounded-full bg-red-50/80 text-red-500 dark:bg-red-900/50 dark:text-red-300 hover:bg-red-500 hover:text-white transition flex items-center justify-center active:scale-95 backdrop-blur-md shadow-sm border border-white/50"><i
                            class="fas fa-times text-xs"></i></button>
                </div>
            </div>

            <div class="overflow-y-auto p-5 space-y-5 flex-1 custom-scrollbar pb-32">
                <form id="form-order" class="space-y-5" onsubmit="return false;">
                    <input type="hidden" id="entry-id">

                    <div class="relative group p-1 rounded-[24px] crystal-card overflow-hidden">

                        <div
                            class="absolute top-[-10px] right-[-10px] p-4 opacity-[0.05] text-8xl text-blue-600 pointer-events-none transform rotate-12 z-0">
                            <i class="fas fa-user"></i>
                        </div>

                        <div class="p-4 relative z-10">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 shadow-md shadow-blue-500/30 flex items-center justify-center text-white sticker-float"
                                    style="animation-delay: 0.5s;">
                                    <i class="fas fa-user text-[10px]"></i>
                                </div>
                                <span
                                    class="text-xs font-extrabold text-blue-800 dark:text-blue-200 uppercase tracking-widest drop-shadow-sm">
                                    á¢áá·áá·á‡á“ (Customer)
                                </span>
                            </div>

                            <div class="space-y-3">
                                <div class="relative z-20">
                                    <input type="text" id="cust-name" placeholder="áˆáŸ’á˜áŸ„áŸ‡á¢áá·áá·á‡á“" required
                                        class="oled-input w-full h-[48px] rounded-xl text-gray-900 dark:text-white font-bold text-lg text-left pl-4 pr-10 outline-none">
                                    <button type="button"
                                        onclick="navigator.clipboard.readText().then(t => { document.getElementById('cust-name').value = t; ui.showToast('á”á¶á“ Paste áˆáŸ’á˜áŸ„áŸ‡'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                        class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                        <i class="fas fa-paste"></i>
                                    </button>
                                </div>
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="relative z-20">
                                        <input type="tel" inputmode="numeric" id="cust-phone" placeholder="á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘"
                                            class="oled-input h-[44px] w-full rounded-xl text-gray-800 dark:text-gray-200 text-sm text-left pl-4 pr-10 outline-none">
                                        <button type="button"
                                            onclick="navigator.clipboard.readText().then(t => { document.getElementById('cust-phone').value = t; ui.showToast('á”á¶á“ Paste á›áŸáá‘á¼ášáŸáŸá–áŸ’á‘'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                            <i class="fas fa-paste"></i>
                                        </button>
                                    </div>

                                    <div class="relative z-20">
                                        <input type="text" id="cust-addr" placeholder="á‘á¸áá¶áŸ†á„"
                                            class="oled-input h-[44px] w-full rounded-xl text-gray-800 dark:text-gray-200 text-sm text-left pl-4 pr-16 outline-none truncate">

                                        <button type="button"
                                            onclick="navigator.clipboard.readText().then(t => { document.getElementById('cust-addr').value = t; ui.showToast('á”á¶á“ Paste á‘á¸áá¶áŸ†á„'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                            class="absolute inset-y-0 right-8 pr-2 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                            <i class="fas fa-paste"></i>
                                        </button>

                                        <button type="button" onclick="ui.openAddressModal()"
                                            class="absolute right-1 top-1 bottom-1 w-8 flex items-center justify-center text-blue-500 hover:text-blue-700 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition z-30">
                                            <i class="fas fa-expand-alt text-xs"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="relative z-20 mt-3">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fab fa-facebook-messenger text-blue-500"></i>
                                    </div>
                                    <input type="text" id="cust-fb"
                                        placeholder="áŠá¶á€áŸ‹ Link Profile á—áŸ’á‰áŸ€áœ á¬ Username (FB)"
                                        class="oled-input w-full h-[44px] rounded-xl text-gray-800 dark:text-gray-200 text-sm text-left pl-10 pr-10 outline-none">
                                    <button type="button"
                                        onclick="navigator.clipboard.readText().then(t => { document.getElementById('cust-fb').value = t; ui.showToast('á”á¶á“ Paste Link Facebook'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                        <i class="fas fa-paste"></i>
                                    </button>
                                </div>
                                <p class="text-[9px] text-gray-400 mt-1 pl-2">* á‡á½á™á±áŸ’á™á„á¶á™áŸáŸ’ášá½á›á†á¶áá‘áŸ…á—áŸ’á‰áŸ€áœá–áŸá›á¥áœáŸ‰á¶á“áŸ‹á˜á€áŠá›áŸ‹
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="relative group p-1 rounded-[24px] crystal-card overflow-hidden mt-4">

                        <div
                            class="absolute top-[-10px] right-[-10px] p-4 opacity-[0.05] text-8xl text-purple-600 pointer-events-none transform -rotate-12 z-0">
                            <i class="fas fa-box-open"></i>
                        </div>

                        <div class="p-4 relative z-10">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-7 h-7 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 shadow-md shadow-purple-500/30 flex items-center justify-center text-white sticker-float"
                                    style="animation-delay: 1s;">
                                    <i class="fas fa-gift text-[10px]"></i>
                                </div>
                                <span
                                    class="text-xs font-extrabold text-purple-800 dark:text-purple-200 uppercase tracking-widest drop-shadow-sm">
                                    á‘áŸ†á“á·á‰ (Product)
                                </span>
                            </div>

                            <div class="space-y-3">

                                <div class="grid grid-cols-2 gap-3">
                                    <div class="relative z-20">
                                        <div
                                            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-barcode text-gray-400"></i>
                                        </div>

                                        <input type="text" id="track-no" inputmode="numeric" placeholder="á›áŸá Tracking"
                                            class="oled-input h-[44px] w-full rounded-xl text-gray-800 dark:text-gray-200 text-sm font-bold pl-9 pr-10 outline-none placeholder:font-normal">

                                        <button
                                            onclick="navigator.clipboard.readText().then(t => { document.getElementById('track-no').value = t; ui.showToast('á”á¶á“ Paste'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                            <i class="fas fa-paste"></i>
                                        </button>
                                    </div>

                                    <div class="relative z-20">
                                        <div
                                            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-link text-blue-400"></i>
                                        </div>
                                        <input type="text" id="prod-img" placeholder="Link ášá¼á”á—á¶á– (URL)"
                                            class="oled-input h-[44px] w-full rounded-xl text-blue-600 dark:text-blue-400 text-xs text-left pl-9 pr-10 outline-none">

                                        <button
                                            onclick="navigator.clipboard.readText().then(t => { document.getElementById('prod-img').value = t; ui.showToast('á”á¶á“ Paste Link ášá¼á”á—á¶á–'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                            <i class="fas fa-paste"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="relative z-20">
                                    <input type="text" id="prod-name" placeholder="áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰ (Product Name)" required
                                        class="oled-input w-full h-[48px] rounded-xl text-gray-900 dark:text-white font-bold text-lg text-left pl-4 pr-10 outline-none">
                                    <button type="button"
                                        onclick="navigator.clipboard.readText().then(t => { document.getElementById('prod-name').value = t; ui.showToast('á”á¶á“ Paste áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰'); }).catch(() => ui.showToast('áŸá¼á˜á…á»á…á‡á¶á”áŸ‹áŠá¾á˜áŸ’á”á¸ Paste'));"
                                        class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-blue-500 active:scale-90 transition z-30">
                                        <i class="fas fa-paste"></i>
                                    </button>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <input type="text" id="prod-size" placeholder="Size"
                                        class="oled-input h-[44px] rounded-xl text-gray-800 dark:text-gray-200 text-left pl-4 outline-none relative z-20">
                                    <input type="number" id="prod-qty" value="1" placeholder="Qty"
                                        class="oled-input h-[44px] rounded-xl text-gray-900 dark:text-white font-bold text-left pl-4 outline-none relative z-20">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">

                        <div
                            class="relative p-3 rounded-[28px] bg-gradient-to-br from-teal-50/80 to-teal-100/50 dark:from-teal-900/30 dark:to-teal-800/20 border border-white/60 dark:border-white/10 shadow-sm flex flex-col gap-3 backdrop-blur-md">

                            <div class="text-center pb-1 pt-1">
                                <span
                                    class="text-[10px] sm:text-[11px] font-black text-teal-800 dark:text-teal-300 uppercase tracking-widest whitespace-nowrap drop-shadow-sm">á…áŸ†áá¼á›
                                    (Income)</span>
                            </div>

                            <div class="flex flex-col gap-2 relative z-10">
                                <input type="number" step="any" inputmode="decimal" id="val-sale" placeholder="á›á€áŸ‹ ($)"
                                    class="oled-input w-full h-[48px] rounded-2xl text-teal-800 dark:text-teal-300 font-bold text-lg text-left pl-4 outline-none placeholder:text-teal-700/30">

                                <input type="number" step="any" inputmode="decimal" id="val-ship-in"
                                    placeholder="á—áŸ’á‰áŸ€áœá…áŸá‰ááŸ’á›áŸƒáŠá¹á€"
                                    class="oled-input w-full h-[48px] rounded-2xl text-gray-800 dark:text-gray-200 text-sm text-left pl-4 outline-none placeholder:text-gray-400">

                                <div class="flex items-center gap-1 h-[48px]">
                                    <div
                                        class="w-[50%] flex flex-col items-center justify-center leading-none flex-shrink-0">
                                        <span
                                            class="text-[10px] sm:text-[11px] font-bold text-teal-800 dark:text-teal-300 whitespace-nowrap">á¢ááŸ’ášá¶á”áŸ’áŠá¼ášá”áŸ’ášá¶á€áŸ‹</span>
                                        <span
                                            class="text-[8px] sm:text-[9px] text-red-500 font-bold mt-1 scale-90 whitespace-nowrap">(áŸá˜áŸ’ášá¶á”áŸ‹ááŸ‚á—áŸ’á‰áŸ€áœ)</span>
                                    </div>

                                    <div class="w-[50%] relative h-full">
                                        <input type="number" inputmode="numeric" id="inv-rate-input" placeholder="4100"
                                            class="oled-input w-full h-full rounded-2xl text-right font-bold text-gray-900 dark:text-white outline-none pr-6 text-sm">
                                        <span
                                            class="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] font-bold text-gray-400 pointer-events-none">áŸ›</span>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div
                            class="relative p-3 rounded-[28px] bg-gradient-to-br from-rose-50/80 to-rose-100/50 dark:from-rose-900/30 dark:to-rose-800/20 border border-white/60 dark:border-white/10 shadow-sm flex flex-col gap-3 backdrop-blur-md">

                            <div class="text-center pb-1 pt-1">
                                <span
                                    class="text-[10px] sm:text-[11px] font-black text-rose-800 dark:text-rose-300 uppercase tracking-widest whitespace-nowrap drop-shadow-sm">á…áŸ†áá¶á™
                                    (Cost)</span>
                            </div>

                            <div class="flex flex-col gap-2 relative z-10">
                                <input type="number" step="any" inputmode="decimal" id="cost-buy"
                                    placeholder="ááŸ’á›áŸƒáŠá¾á˜ ($)"
                                    class="oled-input w-full h-[48px] rounded-2xl text-gray-900 dark:text-gray-100 font-bold text-left pl-4 outline-none placeholder:text-rose-700/30">

                                <input type="number" step="any" inputmode="decimal" id="cost-ship"
                                    placeholder="ááŸ’á›áŸƒáŠá¹á€á…áŸá‰ ($)"
                                    class="oled-input w-full h-[48px] rounded-2xl text-gray-800 dark:text-gray-200 text-sm text-left pl-4 outline-none placeholder:text-gray-400">

                                <input type="number" step="any" inputmode="decimal" id="cost-boost"
                                    placeholder="Boost ($)"
                                    class="oled-input w-full h-[48px] rounded-2xl text-gray-800 dark:text-gray-200 text-sm text-left pl-4 outline-none placeholder:text-gray-400">
                            </div>
                        </div>
                    </div>

                    <div
                        class="p-1.5 rounded-[24px] bg-gradient-to-r from-yellow-50/80 to-amber-50/80 dark:from-yellow-900/20 dark:to-amber-900/20 border border-white/50 dark:border-white/10">
                        <input type="text" id="note" placeholder="ğŸ“ áŸášáŸáŸášá…áŸ†áá¶áŸ† (Note)..."
                            class="w-full h-[45px] bg-transparent rounded-xl px-4 text-gray-800 dark:text-gray-200 font-sans text-left outline-none placeholder:text-gray-400 placeholder:font-normal font-medium">
                    </div>

                    <div class="relative pb-6">
                        <input type="hidden" id="status" value="pending">

                        <div id="formStatusBtn"
                            class="oled-input w-full h-[60px] px-5 rounded-[24px] flex justify-between items-center cursor-pointer transition-all active:scale-95">
                            <div class="flex items-center gap-3">
                                <span id="formStatusIcon" class="text-xl">â³</span>
                                <span id="formStatusText"
                                    class="text-base font-bold text-gray-800 dark:text-white">ášá„áŸ‹á…á¶áŸ† (Pending)</span>
                            </div>
                            <i class="fas fa-chevron-down text-gray-400"></i>
                        </div>
                    </div>
                    <div id="status-log-wrapper"
                        class="hidden rounded-[24px] overflow-hidden bg-white/50 dark:bg-slate-800/60 border border-white/60 dark:border-white/10 backdrop-blur-xl">
                    </div>
                    <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <div
                                class="w-7 h-7 rounded-lg bg-gradient-to-br from-slate-500 to-slate-700 shadow-md flex items-center justify-center text-white">
                                <i class="fas fa-history text-[10px]"></i>
                            </div>
                            <span
                                class="text-xs font-extrabold text-gray-600 dark:text-gray-300 uppercase tracking-widest">á”áŸ’ášáœááŸ’áá·áŸáŸ’áá¶á“á—á¶á–
                                (Status Log)</span>
                        </div>
                        <div id="status-log-container" class="space-y-0"></div>
                    </div>
            </div>

            </form>
        </div>

        <div class="absolute bottom-6 left-0 w-full flex justify-center z-30 pointer-events-none">
            <button type="button" onclick="ui.saveOrder()"
                class="pointer-events-auto w-[85%] sm:w-[400px] h-[64px] rounded-[32px] bg-gradient-to-br from-[#0d9488] to-[#0f766e] text-white font-black text-xl shadow-[0_15px_35px_rgba(13,148,136,0.4)] dark:shadow-[0_15px_35px_rgba(45,212,191,0.2)] transition-all transform active:scale-[0.95] flex justify-center items-center gap-3 border-[4px] border-white/20 backdrop-blur-md ring-1 ring-white/30">
                <i class="fas fa-save text-2xl drop-shadow-md"></i> <span class="drop-shadow-sm tracking-wide">ášá€áŸ’áŸá¶á‘á»á€
                    (SAVE)</span>
            </button>
        </div>

    </div>
    </div>
    <div id="invoice-modal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-xl overflow-hidden shadow-2xl animate-fade-in relative">
            <div id="invoice-viewer" class="p-6 bg-white text-black font-sans relative"></div>
            <div id="invoice-actions" class="bg-gray-100 p-4 flex justify-between gap-3 border-t border-gray-200">
                <button onclick="ui.closeModal('invoice-modal')"
                    class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-bold text-xs">á”á·á‘</button>
                <button onclick="ui.saveInvoiceAsImage()"
                    class="px-4 py-2 rounded-lg bg-blue-600 text-white font-bold text-xs shadow hover:bg-blue-700"><i
                        class="fas fa-image mr-2"></i> Save Img</button>
                <button onclick="ui.printCurrentInvoice()"
                    class="flex-1 px-4 py-2 rounded-lg bg-teal-600 text-white font-bold text-xs shadow-lg hover:bg-teal-700"><i
                        class="fas fa-print mr-2"></i> Print / PDF</button>
            </div>
        </div>
    </div>

    <div id="modal-trash" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 hidden overflow-y-auto animate-slide-up">
        <div class="sticky top-0 bg-red-500 text-white shadow-md p-4 flex items-center justify-between z-10 pt-6">
            <div class="flex items-center gap-3"><button onclick="ui.closeModal('modal-trash')"
                    class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-white hover:bg-white/30"><i
                        class="fas fa-arrow-left"></i></button>
                <h2 class="text-xl font-bold font-serif-kh">á’á»á„áŸáŸ†ášá¶á˜</h2>
            </div>
            <button onclick="dataManager.emptyTrash()"
                class="text-sm font-bold px-4 py-2 bg-white text-red-500 rounded-lg shadow-sm">áŸá˜áŸ’á¢á¶áá‘á¶áŸ†á„á¢áŸáŸ‹</button>
        </div>
        <div id="trash-list" class="p-4 space-y-3 pb-24"></div>
    </div>

    <div id="modal-confirm-overlay"
        class="fixed inset-0 bg-black/60 z-[10000] hidden flex items-center justify-center backdrop-blur-sm">
        <div
            class="confirm-box bg-white dark:bg-gray-800 w-[85%] max-w-[320px] p-6 rounded-2xl shadow-2xl animate-pop-in text-center">
            <div id="confirm-icon-box"
                class="w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-4 bg-red-100 text-red-500 dark:bg-red-900/30">
                <i id="confirm-icon" class="fas fa-exclamation-triangle text-2xl"></i>
            </div>
            <h3 id="confirm-title" class="text-lg font-bold text-gray-800 dark:text-white mb-2 font-serif-kh">
                á”á‰áŸ’á‡á¶á€áŸ‹áŸá€á˜áŸ’á˜á—á¶á–?</h3>
            <p id="confirm-desc" class="text-sm text-gray-500 dark:text-gray-400 mb-6 font-sans">
                áá¾á¢áŸ’á“á€á–á·áá‡á¶á…á„áŸ‹á”á“áŸ’ááŸá€á˜áŸ’á˜á—á¶á–á“áŸáŸ‡á˜áŸ‚á“á‘áŸ?</p>
            <div class="flex gap-3">
                <button onclick="ui.closeConfirm()"
                    class="flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-300 font-bold text-sm hover:bg-gray-50 dark:hover:bg-gray-700 transition">ááŸ’ášá¡á”áŸ‹á€áŸ’ášáŸ„á™</button>
                <button id="btn-confirm-yes" onclick="ui.onConfirmYes()"
                    class="flex-1 py-3 rounded-xl bg-red-600 text-white font-bold text-sm shadow-lg shadow-red-200 dark:shadow-none hover:bg-red-700 transition">á™á›áŸ‹á–áŸ’ášá˜</button>
            </div>
        </div>
    </div>

    <div id="modal-import-overlay"
        class="fixed inset-0 bg-black/60 z-[10000] hidden flex items-center justify-center backdrop-blur-sm">
        <div
            class="confirm-box bg-white dark:bg-gray-800 w-[85%] max-w-[320px] p-6 rounded-2xl shadow-2xl animate-slide-up text-center">
            <div
                class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-file-import text-xl"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2 font-serif-kh">á”á‰áŸ’á…á¼á›á‘á·á“áŸ’á“áŸá™?</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4" id="import-msg-count">á”á¶á“ášá€áƒá¾á‰ ... á‘á·á“áŸ’á“áŸá™</p>
            <div class="flex gap-3">
                <button onclick="document.getElementById('modal-import-overlay').classList.add('hidden')"
                    class="flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-300 font-bold text-sm bg-transparent">á”áŸ„áŸ‡á”á„áŸ‹</button>
                <button id="btn-confirm-import"
                    class="flex-1 py-3 rounded-xl bg-blue-600 text-white font-bold text-sm shadow-lg shadow-blue-200 dark:shadow-none">á™á›áŸ‹á–áŸ’ášá˜</button>
            </div>
        </div>
    </div>

    <script>
        if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('sw.js').then(reg => console.log('SW Registered!', reg.scope)).catch(err => console.log('SW Error:', err)); }); }

        window.onerror = (m) => { document.getElementById('app-loader').style.display = 'none'; console.error(m); };

        let lastScrollTop = 0;
        let scrollUpAccumulator = 0;
        const homeHeader = document.getElementById('home-header-container');
        const reportHeader = document.getElementById('report-header-container');

        window.addEventListener('scroll', () => {
            const s = window.pageYOffset || document.documentElement.scrollTop;
            const delta = s - lastScrollTop;
            if (s <= 0) {
                homeHeader.classList.remove('hide-ui');
                reportHeader.classList.remove('hide-ui');
                scrollUpAccumulator = 0;
                return;
            }
            if (delta > 0) {
                scrollUpAccumulator = 0;
                if (s > 60) {
                    homeHeader.classList.add('hide-ui');
                    reportHeader.classList.add('hide-ui');
                }
            } else {
                scrollUpAccumulator += delta;
                if (scrollUpAccumulator < -120) {
                    homeHeader.classList.remove('hide-ui');
                    reportHeader.classList.remove('hide-ui');
                }
            }
            lastScrollTop = s;
        }, { passive: true });

        const DB_CONFIG = { name: 'ShopProV67', version: 1, store: 'orders' }; let dbConn;
        let deleteIdTarget = null;
        let fpStart, fpEnd;

        const db = {
            init: () => new Promise(r => { const q = indexedDB.open(DB_CONFIG.name, DB_CONFIG.version); q.onupgradeneeded = e => { const d = e.target.result; if (!d.objectStoreNames.contains(DB_CONFIG.store)) d.createObjectStore(DB_CONFIG.store, { keyPath: 'id' }); }; q.onsuccess = e => { dbConn = e.target.result; r(); }; }),
            getAll: (s = DB_CONFIG.store) => new Promise(r => { if (!dbConn) return r([]); const q = dbConn.transaction(s, 'readonly').objectStore(s).getAll(); q.onsuccess = () => r(q.result || []); }),
            put: (d, s = DB_CONFIG.store) => new Promise(r => { if (!dbConn) return; const q = dbConn.transaction(s, 'readwrite').objectStore(s).put(d); q.oncomplete = () => r(); }),
            delete: (id, s = DB_CONFIG.store) => new Promise(r => { if (!dbConn) return; const q = dbConn.transaction(s, 'readwrite').objectStore(s).delete(id); q.oncomplete = () => r(); }),
            clear: (s = DB_CONFIG.store) => new Promise(r => { if (!dbConn) return; const q = dbConn.transaction(s, 'readwrite').objectStore(s).clear(); q.oncomplete = () => r(); })
        };

        const app = {

            data: [], filter: 'all', config: { sysRate: 4100, sysMode: 'manual', invRate: 4100 },
            init: async () => {
                await db.init();
                const savedConfig = localStorage.getItem('shopConfig');
                if (savedConfig) app.config = JSON.parse(savedConfig);
                document.getElementById('app-loader').style.display = 'flex';
                await app.refresh(true);
                if (localStorage.getItem('theme') === 'dark') { document.documentElement.classList.add('dark'); document.getElementById('theme-icon').className = 'fas fa-sun text-yellow-300'; }
                history.replaceState({ page: 'home' }, null, '');
                window.onpopstate = ui.handleBack;

                ui.initDatePickers();
                ui.setReportDate('today');

                ui.switchTab('home');

                setTimeout(() => { document.getElementById('app-loader').style.opacity = '0'; setTimeout(() => document.getElementById('app-loader').style.display = 'none', 500); }, 800);
            },
            refresh: async (skipStats = false) => {
                const all = await db.getAll();
                app.data = all.sort((a, b) => (b.id) - (a.id));
                ui.renderHome();
                if (!skipStats) ui.renderStats();
                ui.renderHistory();
            },
            calc: (o) => {
                // á€á¶ášá–á¶ášá€á¶ášá”á‰áŸ’á…á¼á›á›áŸáá¢áœá·á‡áŸ’á‡á˜á¶á“ (Logic Fix #3)
                const vSale = Math.abs(parseFloat(o.valSale) || 0);
                const vShipIn = Math.abs(parseFloat(o.valShipIn) || 0);
                const cBuy = Math.abs(parseFloat(o.costBuy) || 0);
                const cShip = Math.abs(parseFloat(o.costShip) || 0);
                const cBoost = Math.abs(parseFloat(o.costBoost) || 0);

                // áŠáŸ„áŸ‡áŸáŸ’ášá¶á™á”á‰áŸ’á á¶ Cancelled (Logic Fix #1)
                const isCancel = o.status === 'cancelled';

                // á”á¾ Cancelled: á…áŸ†áá¼á›=0, ááŸ’á›áŸƒáŠá¾á˜á‘áŸ†á“á·á‰=0 (á–áŸ’ášáŸ„áŸ‡á”á¶á“ášá”áŸáŸ‹áœá·á‰), ááŸ‚ááŸ’á›áŸƒáŠá¹á€á…áŸá‰ á“á·á„ Boost ááŸ’ášá¼áœášá¶á”áŸ‹áá¶áá¶á
                const sale = isCancel ? 0 : vSale;
                const shipIn = isCancel ? 0 : vShipIn;
                const costBuy = isCancel ? 0 : cBuy;

                const inc = sale + shipIn;
                const exp = costBuy + cShip + cBoost; // ášá¶á”áŸ‹á”á‰áŸ’á…á¼á›ááŸ’á›áŸƒáŠá¹á€á…áŸá‰ á“á·á„ Boost á‡á¶á“á·á…áŸ’á…á‘áŸ„áŸ‡ Cancel á€áŸáŠáŸ„á™

                return { income: inc, expense: exp, profit: inc - exp, cogs: costBuy, shipExp: cShip, boost: cBoost, sale: sale, shipIn: shipIn };
            },
            saveConfig: () => localStorage.setItem('shopConfig', JSON.stringify(app.config)),
            formatKHR: (usd, type = 'sys') => {
                const rate = type === 'sys' ? app.config.sysRate : app.config.invRate;
                const khr = Math.round(usd * rate);
                // á”á“áŸ’ááŸ‚á˜ w-full á“á·á„ text-center áŠá¾á˜áŸ’á”á¸á±áŸ’á™áœá¶á“áŸ…á€ááŸ’áŠá¶á›á’áŸ€á”á“á¹á„á›áŸááá¶á„á›á¾
                return `<div style="font-size: 0.4em; opacity: 0.7; margin-top: 0px; line-height: 1.2; font-weight:normal; width: 100%; text-align: center;">${new Intl.NumberFormat('km-KH').format(khr)} áŸ›</div>`;
            }
        };

        const ui = {
            // ===========================================
            // 1. SAVE IMAGE (FINAL FIX: AUTO-HEIGHT & CRISP TEXT)
            // ===========================================
            saveInvoiceAsImage: () => {
                const source = document.getElementById('invoice-viewer');
                if (!source) return;

                ui.showToast("â³ á€áŸ†á–á»á„á”á„áŸ’á€á¾áášá¼á”á—á¶á–...");

                // 1. á”á„áŸ’á€á¾á Container ááŸ’á˜á¸áŸá˜áŸ’ášá¶á”áŸ‹áá
                const container = document.createElement('div');

                // á…á˜áŸ’á›á„ HTML á–á¸ Preview
                container.innerHTML = source.innerHTML;

                // 2. á€áŸ†áááŸ‹ Style á±áŸ’á™á…áŸ’á”á¶áŸáŸ‹á›á¶áŸáŸ‹ (áŸáŸ†áá¶á“áŸ‹á”áŸ†á•á»á!)
                // á™á¾á„á”áŸ’ášá¾ width 450px áŠá¾á˜áŸ’á”á¸á±áŸ’á™áœá¶á…áŸá‰á˜á€ "áœáŸ‚á„" (Long Receipt Style)
                // á”á¾áŠá¶á€áŸ‹ Width á’áŸ†á–áŸá€ áœá¶á“á¹á„á…áŸá‰á˜á€ááŸ’á›á¸
                container.style.cssText = `
                    position: fixed; 
                    top: 0; left: 0;
                    width: 450px; /* á‘á‘á¹á„áŸáŸ’áá„áŸ‹áŠá¶ášáœá·á€áŸ’á€á™á”ááŸ’áš */
                    height: auto !important; /* á±áŸ’á™áœá¶áœáŸ‚á„á…á»áŸ‡á€áŸ’ášáŸ„á˜áá¶á˜á‘á·á“áŸ’á“áŸá™ */
                    min-height: 100%;
                    background-color: #ffffff !important;
                    color: #000000 !important;
                    font-family: 'Battambang', sans-serif;
                    z-index: -9999; /* á›á¶á€áŸ‹á“áŸ…áá¶á„á€áŸ’ášáŸ„á™ */
                    padding: 30px;
                    box-sizing: border-box;
                    margin: 0;
                    overflow: visible !important; /* á”á„áŸ’ááŸ†á±áŸ’á™á”á„áŸ’á á¶á‰á‘á¶áŸ†á„á¢áŸáŸ‹ */
                `;

                // á”á„áŸ’ááŸ† Light Mode
                container.classList.add('bg-white', 'text-black');

                // 3. áŸá˜áŸ’á¢á¶á CSS áŠáŸ‚á›á’áŸ’áœá¾á±áŸ’á™á”áŸ‚á€ Layout (áŸáŸ†áá¶á“áŸ‹áá¶áŸáŸ‹!)
                // áŠáŸ„áŸ‡ Class áá¶áŠáŸ‚á›á€áŸ†áááŸ‹á€áŸ†á–áŸáŸ‹ á¬ Scroll á…áŸ„á›
                const allElements = container.getElementsByTagName("*");
                for (let i = 0; i < allElements.length; i++) {
                    const el = allElements[i];
                    el.classList.remove('dark'); // á›á»á” Dark Mode
                    el.style.overflow = 'visible'; // á›á»á” Scrollbar
                    el.style.maxHeight = 'none'; // á›á»á”á€á¶ášá€áŸ†áááŸ‹á€áŸ†á–áŸáŸ‹á¢áá·á”ášá˜á¶

                    // á”á„áŸ’ááŸ†á–ááŸŒá¢á€áŸ’áŸášá±áŸ’á™ááŸ’á˜áŸ…á…áŸ’á”á¶áŸáŸ‹
                    const style = window.getComputedStyle(el);
                    if (style.color === 'rgb(255, 255, 255)' || style.color === 'rgb(209, 213, 219)') {
                        el.style.color = '#000000';
                    }
                    if (style.backgroundColor === 'rgb(31, 41, 59)' || style.backgroundColor === 'rgba(0, 0, 0, 0)') {
                        el.style.backgroundColor = 'transparent';
                    }
                }

                document.body.appendChild(container);

                // 4. ááášá¼á”á—á¶á–
                setTimeout(() => {
                    // áœá¶áŸáŸ‹á€á˜áŸ’á–áŸáŸ‹á–á·áá”áŸ’ášá¶á€áŠá”á“áŸ’á‘á¶á”áŸ‹á–á¸ Render á…á”áŸ‹
                    const realHeight = container.scrollHeight;

                    html2canvas(container, {
                        scale: 3, // á‚á»áá—á¶á–á…áŸ’á”á¶áŸáŸ‹ááŸ’á›á¶áŸ†á„ (3x Resolution)
                        useCORS: true,
                        backgroundColor: "#ffffff",
                        width: 450, // ááá‘á‘á¹á„ 450px
                        height: realHeight, // ááá€á˜áŸ’á–áŸáŸ‹á–áŸá‰á›áŸá‰
                        windowWidth: 450,
                        windowHeight: realHeight,
                        scrollY: -window.scrollY,
                        onclone: (clonedDoc) => {
                            clonedDoc.documentElement.classList.remove('dark');
                        }
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = `Invoice_${Date.now()}.png`;
                        link.href = canvas.toDataURL("image/png", 1.0);
                        link.click();

                        if (document.body.contains(container)) document.body.removeChild(container);
                        ui.showToast("âœ… ášá€áŸ’áŸá¶á‘á»á€á‡áŸ„á‚á‡áŸá™!");
                    }).catch(err => {
                        console.error(err);
                        if (document.body.contains(container)) document.body.removeChild(container);
                        ui.showToast("âŒ á”ášá¶á‡áŸá™á€áŸ’á“á»á„á€á¶ášášá€áŸ’áŸá¶á‘á»á€");
                    });
                }, 800); // á‘á»á€á–áŸá› 0.8s á±áŸ’á™ Browser ášáŸ€á” layout á±áŸ’á™áŸáŸ’á¢á¶á
            },
            // ===========================================
            // 2. PRINT / PDF (ááŸ’á˜á¸áŸ– á…áŸá‰ááŸ‚á€áŸ’ášáŠá¶áŸáœá·á€áŸ’á€á™á”ááŸ’áš)
            // ===========================================
            // ===========================================
            // 2. PRINT / PDF (FIXED: A4 Standard, No Black BG, Single Page)
            // ===========================================
            // ===========================================
            // 2. PRINT / PDF (FIXED: A4 Full Page & Clean)
            // ===========================================
            printCurrentInvoice: () => {
                const content = document.getElementById('invoice-viewer');
                if (!content) return;

                const iframe = document.createElement('iframe');
                iframe.style.cssText = 'position:fixed; right:0; bottom:0; width:0; height:0; border:0; visibility:hidden;';
                document.body.appendChild(iframe);

                const doc = iframe.contentWindow.document;
                doc.open();
                doc.write(`
                    <!DOCTYPE html>
                    <html lang="km">
                        <head>
                            <title>Print Invoice</title>
                            <script src="https://cdn.tailwindcss.com"></scr` + `ipt>
                            <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
                            <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&display=swap" rel="stylesheet">
                            <style>
                                @import url('https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&display=swap');
                                
                                @page {
                                    size: A4;
                                    margin: 0;
                                }
                                
                                html, body {
                                    margin: 0;
                                    padding: 0;
                                    width: 100%;
                                    background-color: #ffffff !important;
                                    -webkit-print-color-adjust: exact !important;
                                    print-color-adjust: exact !important;
                                }

                                body {
                                    font-family: 'Battambang', sans-serif;
                                    padding: 15mm; /* á‚á˜áŸ’á›á¶áá–á¸á‚áŸ‚á˜á€áŸ’ášáŠá¶áŸ */
                                }

                                .invoice-container {
                                    width: 100%;
                                    max-width: 100%;
                                    background: white;
                                }

                                /* á€áŸ‚áá˜áŸ’ášá¼áœá‘áŸ†á áŸ†á¢á€áŸ’áŸášá±áŸ’á™áŸá˜á“á¹á„ A4 */
                                .invoice-container * {
                                    font-size: 14px !important; /* á”á„áŸ’ááŸ†á‘áŸ†á áŸ†á¢á€áŸ’áŸášá±áŸ’á™á’áŸ†á›áŸ’á˜á˜á˜á¾á›áƒá¾á‰á…áŸ’á”á¶áŸáŸ‹ */
                                    line-height: 1.5;
                                }
                                
                                /* á€áŸ‚áŸá˜áŸ’ášá½á›á…áŸ†áá„á‡á¾á„ */
                                .invoice-container h2 { font-size: 24px !important; margin-bottom: 10px; }
                                .invoice-container .text-xl { font-size: 20px !important; }
                                .invoice-container .text-lg { font-size: 18px !important; }
                                .invoice-container .text-xs { font-size: 12px !important; }
                                .invoice-container .text-\[10px\], 
                                .invoice-container .text-\[9px\],
                                .invoice-container .text-\[8px\] { font-size: 12px !important; } /* á”áŸ’áá¼ášá¢á€áŸ’áŸášáá¼á…áŸ—á±áŸ’á™á’áŸ†á‡á¶á„á˜á»á“á–áŸá› Print */

                                /* á’á¶á“á¶áá¶á•áŸ’á‘áŸƒá€áŸ’ášáŸ„á™á˜á·á“ááŸ’á˜áŸ… */
                                .bg-teal-50 { background-color: #f0fdfa !important; }
                                .bg-red-50 { background-color: #fef2f2 !important; }
                                .text-white { color: #000 !important; } /* á”á¾á˜á¶á“á¢á€áŸ’áŸášáŸ á±áŸ’á™á…áŸá‰ááŸ’á˜áŸ…áœá·á‰ */
                                
                                ::-webkit-scrollbar { display: none; }
                            </style>
                        </head>
                        <body>
                            <div class="invoice-container">
                                ${content.innerHTML}
                            </div>
                            <script>
                                document.documentElement.classList.remove('dark');
                            </scr` + `ipt>
                        </body>
                    </html>
                `);
                doc.close();

                iframe.contentWindow.onload = function () {
                    setTimeout(() => {
                        iframe.contentWindow.focus();
                        iframe.contentWindow.print();
                        setTimeout(() => {
                            if (document.body.contains(iframe)) document.body.removeChild(iframe);
                        }, 2000);
                    }, 1000);
                };
            },
            showToast: (msg) => { const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2500); },
            toggleTheme: () => { document.documentElement.classList.toggle('dark'); const isDark = document.documentElement.classList.contains('dark'); localStorage.setItem('theme', isDark ? 'dark' : 'light'); document.getElementById('theme-icon').className = isDark ? 'fas fa-sun text-yellow-300' : 'fas fa-moon text-white'; },

            switchTab: (tabId) => {
                if (tabId !== 'home') history.pushState({ page: tabId }, null, '');
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(el => el.classList.remove('active'));

                if (tabId === 'home') navItems[0].classList.add('active');
                if (tabId === 'reports') navItems[1].classList.add('active');
                if (tabId === 'history') navItems[2].classList.add('active');
                if (tabId === 'settings') navItems[3].classList.add('active');

                document.querySelectorAll('.section-view').forEach(el => el.classList.remove('active'));
                document.getElementById(`view-${tabId}`).classList.add('active');

                const homeHeader = document.getElementById('home-header-container');
                const reportHeader = document.getElementById('report-header-container');

                if (tabId === 'home') {
                    homeHeader.style.display = 'block'; reportHeader.style.display = 'none'; homeHeader.classList.remove('hide-ui'); window.scrollTo(0, 0);
                } else if (tabId === 'reports') {
                    homeHeader.style.display = 'none'; reportHeader.style.display = 'block'; reportHeader.classList.remove('hide-ui'); ui.renderStats(); window.scrollTo(0, 0);
                } else {
                    homeHeader.style.display = 'none'; reportHeader.style.display = 'none';
                }

                if (tabId === 'history') { if (typeof renderProfessionalHistory === 'function') renderProfessionalHistory(); }
                if (tabId === 'settings') { ui.renderSettingsRate(); }
            },

            filterList: (f) => { app.filter = f; ui.renderHome(); },
            showNote: (note) => { document.getElementById('note-content-display').innerText = note; document.getElementById('modal-note').classList.remove('hidden'); },

            handleBack: (event) => {
                const modals = ['modal-order', 'invoice-modal', 'modal-trash', 'modal-note', 'modal-confirm-overlay', 'modal-import-overlay'];
                let closed = false;
                for (let id of modals) { let el = document.getElementById(id); if (el && !el.classList.contains('hidden')) { if (id === 'invoice-modal') ui.closeModal('invoice-modal'); else if (id === 'modal-confirm-overlay') ui.closeConfirm(); else el.classList.add('hidden'); closed = true; break; } }
                if (closed) return;
                const activeTab = document.querySelector('.section-view.active');
                if (activeTab && activeTab.id !== 'view-home') { ui.switchTab('home'); return; }
            },

            initDatePickers: () => {
                const config = { dateFormat: "Y-m-d", disableMobile: true, onChange: (selectedDates, dateStr, instance) => { document.querySelectorAll('.date-filter-btn').forEach(b => { b.className = 'date-filter-btn py-2 rounded-lg text-[10px] font-bold border border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 active:scale-95 transition shadow-sm w-full'; }); ui.renderStats(); } };
                fpStart = flatpickr("#date-start", config);
                fpEnd = flatpickr("#date-end", config);
            },

            setReportDate: (range) => {
                const now = new Date(); let start = new Date(); let end = new Date();
                document.querySelectorAll('.date-filter-btn').forEach(b => { b.className = 'date-filter-btn py-2 rounded-lg text-[10px] font-bold border border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-500 dark:text-gray-400 active:scale-95 transition shadow-sm w-full'; });
                const activeBtn = document.getElementById(`btn-${range}`);
                if (activeBtn) activeBtn.className = 'date-filter-btn py-2 rounded-lg text-[10px] font-bold active:scale-95 transition w-full date-btn-active';

                if (range === 'today') { start = now; end = now; }
                else if (range === 'yesterday') { start.setDate(now.getDate() - 1); end.setDate(now.getDate() - 1); }
                else if (range === 'thisWeek') { const day = now.getDay() || 7; if (day !== 1) start.setHours(-24 * (day - 1)); }
                else if (range === 'thisMonth') { start.setDate(1); }

                if (fpStart) fpStart.setDate(start); if (fpEnd) fpEnd.setDate(end); ui.renderStats();
            },

            getFilteredReportData: () => {
                const sStr = document.getElementById('date-start').value; const eStr = document.getElementById('date-end').value;
                if (!sStr || !eStr) return [];
                const s = new Date(sStr); const e = new Date(eStr); s.setHours(0, 0, 0, 0); e.setHours(23, 59, 59, 999);
                return app.data.filter(o => { if (o.isDeleted) return false; const d = new Date(o.updatedAt); return d >= s && d <= e; });
            },

            openDrillDown: (type) => {
                const data = ui.getFilteredReportData();
                const start = document.getElementById('date-start').value; const end = document.getElementById('date-end').value;
                const modal = document.getElementById('modal-drilldown');
                const title = document.getElementById('drill-title'); const sub = document.getElementById('drill-subtitle'); const content = document.getElementById('drill-content'); const footer = document.getElementById('drill-footer');

                modal.classList.remove('hidden'); sub.innerText = `á…á“áŸ’á›áŸ„áŸ‡á€á¶á›á”ášá·á…áŸ’á†áŸá‘: ${start} áŠá›áŸ‹ ${end}`; footer.classList.add('hidden');

                if (type === 'orders') {
                    title.innerHTML = '<i class="fas fa-shopping-cart text-blue-600 mr-2"></i> á”á‰áŸ’á‡á¸á€á¶ášá›á€áŸ‹ (Orders List)'; footer.classList.remove('hidden');
                    if (data.length === 0) { content.innerHTML = '<div class="text-center text-gray-400 mt-10">á‚áŸ’á˜á¶á“á‘á·á“áŸ’á“áŸá™</div>'; return; }
                    let html = '<div class="space-y-3">';
                    data.forEach(o => { const f = app.calc(o); html += `<div class="flex justify-between items-center p-3 bg-white dark:bg-gray-700 rounded-xl border border-gray-100 dark:border-gray-600 shadow-sm active:scale-95 transition cursor-pointer" onclick="ui.openOrderModal(${o.id})"><div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/30 text-blue-600 flex items-center justify-center font-bold text-xs">${o.prodQty}</div><div><div class="font-bold text-gray-800 dark:text-gray-200 text-sm">${o.custName}</div><div class="text-xs text-gray-500">${o.prodName}</div></div></div><div class="text-right"><div class="font-bold text-teal-600">$${f.income.toFixed(2)}</div><div class="text-[10px] text-gray-400">Profit: $${f.profit.toFixed(2)}</div></div></div>`; });
                    content.innerHTML = html + '</div>';
                } else if (type === 'profit') {
                    title.innerHTML = '<i class="fas fa-coins text-emerald-600 mr-2"></i> á”áŸ’ášá—á–á”áŸ’ášá¶á€áŸ‹á…áŸ†ááŸá‰ (P&L)';
                    let tSale = 0, tCogs = 0, tExp = 0, tProf = 0;
                    data.forEach(o => { const f = app.calc(o); tSale += f.sale; tCogs += f.cogs; tExp += (f.expense - f.cogs); tProf += f.profit; });
                    content.innerHTML = `<div class="space-y-4 font-sans"><div class="flex justify-between items-center p-4 bg-blue-50 rounded-2xl border border-blue-100"><div><span class="block text-xs text-blue-500 font-bold uppercase">á…áŸ†áá¼á›á–á¸á€á¶ášá›á€áŸ‹</span></div><div class="text-xl font-bold text-blue-700">$${tSale.toFixed(2)}</div></div><div class="flex justify-center"><i class="fas fa-minus text-gray-300"></i></div><div class="flex justify-between items-center p-3 bg-red-50 rounded-xl border border-red-100"><div><span class="text-sm text-gray-600">ááŸ’á›áŸƒáŠá¾á˜ (COGS)</span></div><div class="font-bold text-red-500">-$${tCogs.toFixed(2)}</div></div><div class="flex justify-between items-center p-3 bg-orange-50 rounded-xl border border-orange-100"><div><span class="text-sm text-gray-600">á…áŸ†áá¶á™á•áŸ’áŸáŸá„áŸ—</span></div><div class="font-bold text-orange-500">-$${tExp.toFixed(2)}</div></div><div class="border-b-2 border-dashed border-gray-300 my-2"></div><div class="flex justify-between items-center p-5 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl shadow-lg text-white"><div><span class="block text-xs text-emerald-100 font-bold uppercase">á…áŸ†ááŸá‰áŸá»á‘áŸ’á’ (Net Profit)</span></div><div class="text-3xl font-bold">$${tProf.toFixed(2)}</div></div></div>`;
                } else if (type === 'margin') {
                    title.innerHTML = '<i class="fas fa-chart-pie text-purple-600 mr-2"></i> áœá·á—á¶á‚ Margin %';
                    let tInc = 0, tCogs = 0, tExp = 0, nProf = 0;
                    data.forEach(o => {
                        if (o.status !== 'completed' && o.status !== 'cancelled') return;
                        const f = app.calc(o); tInc += (f.sale + f.shipIn); tCogs += f.cogs; tExp += (f.shipExp + f.boost); nProf += f.profit;
                    });
                    if (tInc === 0) { content.innerHTML = '<div class="text-center text-gray-400 mt-10 p-4"><i class="fas fa-chart-pie text-4xl mb-3 opacity-30"></i><p>á‚áŸ’á˜á¶á“á…áŸ†áá¼á›á€áŸ’á“á»á„ášá™áŸˆá–áŸá›á“áŸáŸ‡</p></div>'; return; }
                    const pP = parseFloat(((nProf / tInc) * 100).toFixed(1)); const pC = parseFloat(((tCogs / tInc) * 100).toFixed(1)); const pE = parseFloat(((tExp / tInc) * 100).toFixed(1));
                    const chartStyle = `background: conic-gradient(#0d9488 0% ${pP}%, #ef4444 ${pP}% ${pP + pC}%, #f97316 ${pP + pC}% 100%);`;
                    content.innerHTML = `<div class="flex flex-col items-center justify-center pt-4"><div class="relative w-48 h-48 rounded-full shadow-inner mb-6" style="${chartStyle}"><div class="absolute inset-4 bg-white dark:bg-gray-800 rounded-full flex flex-col items-center justify-center shadow-lg"><span class="text-gray-400 text-xs uppercase font-bold">Margin</span><span class="text-4xl font-extrabold text-teal-600">${pP}%</span></div></div><div class="w-full bg-gray-50 dark:bg-gray-700/30 rounded-2xl p-4 space-y-3"><div class="flex justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-teal-600"></div><span class="text-sm">á…áŸ†ááŸá‰ (Profit)</span></div><span class="font-bold text-teal-600">${pP}%</span></div><div class="flex justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-red-500"></div><span class="text-sm">ááŸ’á›áŸƒáŠá¾á˜ (COGS)</span></div><span class="font-bold text-red-500">${pC}%</span></div><div class="flex justify-between"><div class="flex items-center gap-2"><div class="w-3 h-3 rounded bg-orange-500"></div><span class="text-sm">á…áŸ†áá¶á™ (Exp)</span></div><span class="font-bold text-orange-500">${pE}%</span></div></div></div>`;
                }
            },

            renderStats: () => {
                let allTimeProfit = 0; let allTimeOrders = 0;
                app.data.forEach(o => { if (!o.isDeleted && (o.status === 'completed' || o.status === 'cancelled')) { const f = app.calc(o); allTimeProfit += f.profit; allTimeOrders += (o.status === 'completed' ? 1 : 0); } });
                document.getElementById('lbl-lifetime-profit').innerText = `$${allTimeProfit.toFixed(2)}`;
                document.getElementById('lbl-lifetime-orders').innerText = allTimeOrders;

                const data = ui.getFilteredReportData();
                let totalInc = 0, totalCogs = 0, totalShip = 0, totalAds = 0, netProfit = 0, shippingIn = 0;
                let prodMap = {};

                data.forEach(o => {
                    const f = app.calc(o);
                    // á…áŸ†áá¼á› â†’ completed á”áŸ‰á»ááŸ’ááŸ„áŸ‡
                    if (o.status === 'completed') {
                        totalInc += f.sale;
                        shippingIn += f.shipIn;
                        totalCogs += f.cogs;
                    }
                    // á…áŸ†áá¶á™ â†’ completed + cancelled (á€á¶ášáá¶áá–á·á)
                    if (o.status === 'completed' || o.status === 'cancelled') {
                        totalShip += f.shipExp;
                        totalAds += f.boost;
                    }
                    // Top Products â†’ completed á”áŸ‰á»ááŸ’ááŸ„áŸ‡
                    if (o.status === 'completed') {
                        if (!prodMap[o.prodName]) prodMap[o.prodName] = 0;
                        prodMap[o.prodName] += parseInt(o.prodQty);
                    }
                });

                const completedOrders = data.filter(o => o.status === 'completed');
                const pendingOrders = data.filter(o => o.status !== 'completed' && o.status !== 'cancelled');
                let realProfit = 0, expectedProfit = 0;
                completedOrders.forEach(o => { realProfit += app.calc(o).profit; });
                pendingOrders.forEach(o => { expectedProfit += app.calc(o).profit; });

                const elCount = document.getElementById('rpt-order-count'); elCount.innerText = completedOrders.length;
                elCount.parentElement.onclick = () => ui.openDrillDown('orders');
                elCount.parentElement.className = "report-item relative overflow-hidden bg-blue-50 dark:bg-blue-900/20 border-blue-100 dark:border-blue-800 cursor-pointer active:scale-95 transition hover:shadow-lg";

                const elProfit = document.getElementById('rpt-net-profit'); elProfit.innerText = `$${realProfit.toFixed(2)}`;
                const pendingEl = document.getElementById('rpt-pending-note');
                if (pendingEl) pendingEl.innerHTML = pendingOrders.length > 0 ? `<span class="text-xs text-orange-500 font-bold mt-1 block">â³ + $${expectedProfit.toFixed(2)} ášáŸ†á–á¹á„á‘á»á€ (${pendingOrders.length})</span>` : '';
                elProfit.parentElement.onclick = () => ui.openDrillDown('profit');
                elProfit.parentElement.className = "report-item card-gradient-green relative overflow-hidden cursor-pointer active:scale-95 transition hover:shadow-lg";

                document.getElementById('rpt-total-income').innerText = `$${totalInc.toFixed(2)}`;
                const elMargin = document.getElementById('rpt-margin');
                elMargin.parentElement.onclick = () => ui.openDrillDown('margin');
                elMargin.parentElement.className = "bg-gray-50 dark:bg-gray-800 rounded-xl p-3 mt-2 flex justify-between items-center border border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition";

                document.getElementById('rpt-shipping-in').innerText = `$${shippingIn.toFixed(2)}`;
                document.getElementById('rpt-cogs-total').innerText = `$${totalCogs.toFixed(2)}`;
                document.getElementById('rpt-ship-exp').innerText = `$${totalShip.toFixed(2)}`;
                document.getElementById('rpt-ads-total').innerText = `$${totalAds.toFixed(2)}`;
                netProfit = (totalInc + shippingIn) - totalCogs - totalShip - totalAds;
                const margin = ((totalInc + shippingIn) > 0) ? ((netProfit / (totalInc + shippingIn)) * 100) : 0;
                document.getElementById('rpt-margin').innerText = `${margin.toFixed(1)}%`;

                const sortedProds = Object.entries(prodMap).sort((a, b) => b[1] - a[1]).slice(0, 5);
                const list = document.getElementById('top-products-list'); list.innerHTML = '';
                if (sortedProds.length === 0) list.innerHTML = '<div class="p-4 text-center text-xs text-gray-400">á˜á·á“á˜á¶á“á‘á·á“áŸ’á“áŸá™</div>';
                sortedProds.forEach(([name, qty]) => { list.innerHTML += `<div class="p-3 flex justify-between items-center text-sm"><span class="text-gray-700 dark:text-gray-300 font-bold truncate pr-2">${name}</span><span class="px-2 py-1 bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-400 text-xs font-bold rounded-md">${qty} Sold</span></div>`; });
            },

            renderHistory: () => { if (typeof renderProfessionalHistory === 'function') { renderProfessionalHistory(); } },

            exportReportCSV: () => {
                const data = ui.getFilteredReportData();
                if (data.length === 0) { ui.showToast("âš ï¸ á‚áŸ’á˜á¶á“á‘á·á“áŸ’á“áŸá™áŸá˜áŸ’ášá¶á”áŸ‹ Export"); return; }
                let csv = "\uFEFFDate,Product,Customer,Qty,Sale,Cost,Profit\n";
                data.forEach(o => { const f = app.calc(o); csv += `${new Date(o.updatedAt).toLocaleDateString()},"${o.prodName}","${o.custName}",${o.prodQty},${f.sale},${f.expense},${f.profit}\n`; });
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = `Report_${document.getElementById('date-start').value}.csv`; document.body.appendChild(link); link.click(); document.body.removeChild(link);
            },

            generatePDFStatement: () => {
                const data = ui.getFilteredReportData();
                if (data.length === 0) { ui.showToast("âš ï¸ á‚áŸ’á˜á¶á“á‘á·á“áŸ’á“áŸá™áŸá˜áŸ’ášá¶á”áŸ‹ Download"); return; }
                const start = document.getElementById('date-start').value; const end = document.getElementById('date-end').value; const genDate = new Date().toLocaleString('en-US', { dateStyle: 'long', timeStyle: 'short' });
                let tSale = 0, tExp = 0, tProf = 0, tQty = 0; let tableRows = '';
                data.forEach(o => {
                    const f = app.calc(o);
                    if (o.status === 'completed' || o.status === 'cancelled') {
                        tSale += f.income; tExp += f.expense; tProf += f.profit;
                        tQty += parseInt(o.prodQty);
                    } else {
                        return; // âŒ Pending/Shipping â†’ Skip á…áŸá‰á–á¸ Table á•á„
                    }
                    const profitClass = f.profit >= 0 ? 'print-text-teal' : 'print-text-red';
                    let statusBadge = '';
                    if (o.status === 'pending') statusBadge = '<span style="font-size:8px; padding:2px 4px; background:#fff7ed; color:#c2410c; border-radius:3px; border:1px solid #ffedd5;">PENDING</span>';
                    else if (o.status === 'cancelled') statusBadge = '<span style="font-size:8px; padding:2px 4px; background:#fef2f2; color:#b91c1c; border-radius:3px; border:1px solid #fee2e2;">CANCEL</span>';

                    tableRows += `<tr><td style="width: 15%;">${new Date(o.updatedAt).toLocaleDateString()}</td><td style="width: 25%;"><div style="font-weight:bold; color:#1e293b;">${o.custName}</div><div style="font-size:9px; color:#64748b; margin-top:2px;">${o.custPhone}</div></td><td style="width: 25%;"><div style="color:#334155;">${o.prodName} <span style="color:#94a3b8; font-size:10px;">(${o.prodSize || '-'})</span></div><div style="margin-top:2px;">${statusBadge}</div></td><td style="width: 10%; text-align:center; font-weight:bold;">${o.prodQty}</td><td style="width: 12%; text-align:right; font-family:monospace; font-size:12px;">$${f.income.toFixed(2)}</td><td style="width: 13%; text-align:right; font-family:monospace; font-size:12px; font-weight:bold;" class="${profitClass}">${f.profit >= 0 ? '+' : ''}$${f.profit.toFixed(2)}</td></tr>`;
                });

                const printArea = document.getElementById('print-area');
                printArea.innerHTML = `<div><div style="width:100%; height:6px; background: linear-gradient(90deg, #0d9488 0%, #0f766e 100%); margin-bottom: 30px;"></div><div class="flex justify-between items-start mb-10"><div><h1 style="font-family: 'Times New Roman', serif; font-size: 28px; font-weight: 700; letter-spacing: 1px; color: #0f766e; text-transform: uppercase; margin-bottom: 5px;">Bosba Ladies Dress</h1><p style="font-size: 11px; color: #64748b; line-height: 1.5;">Phnom Penh, Cambodia<br>Professional Fashion & Retail</p></div><div style="text-align: right;"><div style="font-size: 24px; font-weight: 300; color: #94a3b8; letter-spacing: 2px; text-transform: uppercase;">Statement</div><div style="margin-top: 8px; font-size: 11px; color: #334155;"><strong>Period:</strong> ${start} â€” ${end}<br><strong>Date:</strong> ${genDate}</div></div></div><div style="display: flex; gap: 15px; margin-bottom: 30px;"><div style="flex: 1; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;"><div style="font-size: 10px; font-weight: 700; text-transform: uppercase; color: #64748b; letter-spacing: 0.5px; margin-bottom: 5px;">Total Revenue</div><div style="font-size: 22px; font-weight: 700; color: #334155;">$${tSale.toFixed(2)}</div></div><div style="flex: 1; padding: 15px; background: #fff1f2; border: 1px solid #ffe4e6; border-radius: 8px;"><div style="font-size: 10px; font-weight: 700; text-transform: uppercase; color: #be123c; letter-spacing: 0.5px; margin-bottom: 5px;">Total Expenses</div><div style="font-size: 22px; font-weight: 700; color: #be123c;">$${tExp.toFixed(2)}</div></div><div style="flex: 1; padding: 15px; background: #f0fdfa; border: 1px solid #ccfbf1; border-radius: 8px;"><div style="font-size: 10px; font-weight: 700; text-transform: uppercase; color: #0f766e; letter-spacing: 0.5px; margin-bottom: 5px;">Net Profit</div><div style="font-size: 22px; font-weight: 700; color: #0d9488;">$${tProf.toFixed(2)}</div></div></div><table><thead><tr><th style="text-align:left;">Date</th><th style="text-align:left;">Customer</th><th style="text-align:left;">Product Details</th><th style="text-align:center;">Qty</th><th style="text-align:right;">Amount</th><th style="text-align:right;">Profit</th></tr></thead><tbody>${tableRows}</tbody><tfoot><tr style="background-color: #fff; border-top: 2px solid #334155;"><td colspan="3" style="text-align:right; padding-top: 15px; font-size: 12px; font-weight: bold; text-transform: uppercase;">Grand Total</td><td style="text-align:center; padding-top: 15px; font-weight: bold; font-size: 13px;">${tQty}</td><td style="text-align:right; padding-top: 15px; font-weight: bold; font-size: 13px;">$${tSale.toFixed(2)}</td><td style="text-align:right; padding-top: 15px; font-weight: bold; font-size: 14px; color: #0f766e;">$${tProf.toFixed(2)}</td></tr></tfoot></table><div style="margin-top: 50px; text-align: center; border-top: 1px solid #e2e8f0; padding-top: 20px;"><p style="font-family: 'Times New Roman', serif; font-style: italic; color: #64748b; font-size: 12px; margin-bottom: 5px;">Thank you for your business!</p><p style="font-size: 10px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px;">Generated by Bosba System â€¢ All Rights Reserved</p></div></div>`;

                printArea.classList.remove('hidden'); document.body.classList.add('printing-statement');
                setTimeout(() => { try { window.print(); } catch (e) { alert("Error: " + e); } finally { setTimeout(() => { document.body.classList.remove('printing-statement'); printArea.classList.add('hidden'); }, 500); } }, 100);
            },

            shareReportText: () => {
                const start = document.getElementById('date-start').value;
                const end = document.getElementById('date-end').value;
                const profit = document.getElementById('rpt-net-profit').innerText;
                const orders = document.getElementById('rpt-order-count').innerText;
                const income = document.getElementById('rpt-total-income').innerText;
                const margin = document.getElementById('rpt-margin').innerText;
                const text = `ğŸ“Š ášá”á¶á™á€á¶ášááŸáŸá„áŸ’ááŸá” (${start} - ${end})\n------------------------\nğŸ’° á…áŸ†ááŸá‰áŸá»á‘áŸ’á’: ${profit}\nğŸ“¦ á…áŸ†á“á½á“á›á€áŸ‹: ${orders}\nğŸ’µ á…áŸ†áá¼á›áŸášá»á”: ${income}\nğŸ“ˆ Margin: ${margin}\n------------------------\ná”á„áŸ’á€á¾ááŠáŸ„á™: My Small Shop App`;
                navigator.clipboard.writeText(text);
                ui.showToast("ğŸ“‹ á”á¶á“á…á˜áŸ’á›á„á¢á€áŸ’áŸášášá”á¶á™á€á¶ášááŸ!");
            },

            renderHome: () => {
                const container = document.getElementById('order-list'); const search = document.getElementById('search-input').value.toLowerCase(); container.innerHTML = '';
                let activeData = app.data.filter(o => !o.isDeleted);

                // === [á…á¶á”áŸ‹á•áŸ’áŠá¾á˜á€á¼áŠá”á“áŸ’ááŸ‚á˜ááŸ’á˜á¸áŸ– á‚áá“á¶á…áŸ†ááŸá‰á‡á¶á€áŸ‹áŸáŸ’áŠáŸ‚á„ á“á·á„ášáŸ†á–á¹á„á‘á»á€] ===
                let realProfit = 0;
                let pendingProfit = 0;
                activeData.forEach(o => {
                    const f = app.calc(o);
                    if (o.status === 'completed') {
                        realProfit += f.profit;
                    } else if (o.status !== 'cancelled') {
                        pendingProfit += f.profit;
                    }
                });

                const dashReal = document.getElementById('dash-real-profit');
                const dashPending = document.getElementById('dash-pending-profit');
                if (dashReal) dashReal.innerText = `$${realProfit.toFixed(2)}`;
                if (dashPending) dashPending.innerText = `$${pendingProfit.toFixed(2)}`;
                // === [á”á‰áŸ’á…á”áŸ‹á€á¼áŠá”á“áŸ’ááŸ‚á˜ááŸ’á˜á¸] ===
                // Logic áŸáŸ’áœáŸ‚á„ášá€ (áŠá¶á€áŸ‹á“áŸ…á•áŸ’á“áŸ‚á€áá¶á„á›á¾á“áŸƒ ui.renderHome)
                // [START] Logic á…áŸ’ášáŸ„áŸ‡á‘á·á“áŸ’á“á“áŸá™ (Search + Status Filter á’áŸ’áœá¾á€á¶ášá–áŸ’ášá˜á‚áŸ’á“á¶)
                // [START] Logic á…áŸ’ášáŸ„áŸ‡á‘á·á“áŸ’á“á“áŸá™ (Search + Status Filter á’áŸ’áœá¾á€á¶ášá–áŸ’ášá˜á‚áŸ’á“á¶)
                const currentStatus = app.filter || 'all'; // á‘á¶á‰á™á€ Status á–á¸á”áŸ’ášá–áŸá“áŸ’á’áŠáŸ‚á›á”á¶á“ášá¾áŸ

                activeData = activeData.filter(o => {
                    // áŸ¡. á†áŸ‚á€á›á€áŸ’ááááŸ’áŒ Search
                    const matchSearch = !search ||
                        (o.custName && o.custName.toLowerCase().includes(search)) ||
                        (o.custPhone && o.custPhone.includes(search)) ||
                        (o.prodName && o.prodName.toLowerCase().includes(search)) ||
                        (o.trackingNo && o.trackingNo.toString().toLowerCase().includes(search));

                    // áŸ¢. á†áŸ‚á€á›á€áŸ’ááááŸ’áŒ Status
                    const matchStatus = (currentStatus === 'all') || (o.status === currentStatus);

                    // ááŸ’ášá¼áœááŸ‚ááŸ’ášá¼áœá‘á¶áŸ†á„ áŸ¢ á›á€áŸ’ááááŸ’áŒ á‘á¾á”á™á€á˜á€á”á„áŸ’á á¶á‰
                    return matchSearch && matchStatus;
                });
                // [END] á”á‰áŸ’á…á”áŸ‹á€áŸ‚á”áŸ’ášáŸ‚
                // [END] á”á‰áŸ’á…á”áŸ‹á€áŸ‚á”áŸ’ášáŸ‚
                // 2. á€á¶ášá”á„áŸ’á€á¾áá€á¶á
                if (activeData.length === 0) { container.innerHTML = `<div class="text-center mt-20 opacity-40"><i class="fas fa-box-open text-5xl mb-3 text-gray-300 dark:text-gray-600"></i><p class="text-sm text-gray-400 dark:text-gray-500">á˜á·á“á˜á¶á“á‘á·á“áŸ’á“áŸá™</p></div>`; return; }

                activeData.forEach(o => {
                    const f = app.calc(o); const totalPay = (parseFloat(o.valSale) || 0) + (parseFloat(o.valShipIn) || 0);
                    const el = document.createElement('div');
                    let st = { bg: 'bg-orange-50', text: 'text-orange-600', strip: 'bg-orange-400', label: 'ášá„áŸ‹á…á¶áŸ†', icon: 'fa-clock' };
                    if (o.status === 'ordered') st = { bg: 'bg-blue-50', text: 'text-blue-600', strip: 'bg-blue-500', label: 'á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹', icon: 'fa-cart-shopping' };
                    if (o.status === 'shipping') st = { bg: 'bg-indigo-50', text: 'text-indigo-600', strip: 'bg-indigo-500', label: 'á€áŸ†á–á»á„áŠá¹á€', icon: 'fa-truck-fast' };
                    if (o.status === 'completed') st = { bg: 'bg-emerald-50', text: 'text-emerald-600', strip: 'bg-emerald-500', label: 'á‡áŸ„á‚á‡áŸá™', icon: 'fa-check-circle' };
                    if (o.status === 'cancelled') st = { bg: 'bg-red-50', text: 'text-red-600', strip: 'bg-red-500', label: 'á”áŸ„áŸ‡á”á„áŸ‹', icon: 'fa-circle-xmark' };

                    let paymentHtml = '';
                    if (o.status === 'completed') paymentHtml = `<span class="text-emerald-600 font-bold text-[11px] flex items-center gap-1"><i class="fas fa-check-circle"></i> á‘á¼á‘á¶ááŸ‹ášá½á…</span>`;
                    else if (o.status !== 'cancelled') paymentHtml = `<span class="text-orange-500 font-bold text-[11px] flex items-center gap-1"><i class="fas fa-clock"></i> ášá„áŸ‹á…á¶áŸ†á€á¶ášá‘á¼á‘á¶ááŸ‹: $${totalPay.toFixed(2)}</span>`;
                    else paymentHtml = `<span class="text-gray-400 font-bold text-[11px]">-</span>`;

                    el.className = 'order-card p-0 group'; el.onclick = () => ui.openOrderModal(o.id);

                    // á”á„áŸ’á€á¾áá”áŸŠá¼áá»á„ Messenger
                    let messengerBtn = '';
                    if (o.fbLink) {
                        messengerBtn = `<a href="${o.fbLink}" target="_blank" onclick="event.stopPropagation();" class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center hover:bg-blue-600 hover:text-white transition border border-blue-200"><i class="fab fa-facebook-messenger text-sm"></i></a>`;
                    } else {
                        messengerBtn = `<div class="w-8 h-8 rounded-full bg-gray-100 text-gray-300 flex items-center justify-center border border-gray-200"><i class="fab fa-facebook-messenger text-sm"></i></div>`;
                    }

                    // á”á„áŸ’á€á¾áá”áŸŠá¼áá»á„ášá¼á”á—á¶á– (Image Button)
                    // [START] á€áŸ‚á”áŸ’ášáŸ‚ Logic ášá¼á”á—á¶á– (á€á¶ášá–á¶áš 404 Error)
                    // [START] á€áŸ‚á”áŸ’ášáŸ‚ Logic ášá¼á”á—á¶á– (á†áŸ’á›á¶áá‡á¶á„á˜á»á“ - Smart Link Extractor)
                    let imgBtn = '';
                    if (o.prodImg) {
                        let link = o.prodImg.trim();

                        // 1. áŸáŸ’áœáŸ‚á„ášá€á˜á¾á›áá¶á˜á¶á“á‡á¶á”áŸ‹ http/https á“áŸ…á€áŸ’á“á»á„á¢á€áŸ’áŸášáŠáŸ‚á› Paste á˜á€áŠáŸ‚ášá‘áŸ?
                        const urlMatch = link.match(/(https?:\/\/[^\s]+)/);

                        if (urlMatch) {
                            // á”á¾á˜á¶á“, á™á€ááŸ‚á•áŸ’á“áŸ‚á€ Link á“áŸ„áŸ‡á˜á€á”áŸ’ášá¾ (á€á¶ááŸ‹á¢á€áŸ’áŸášá•áŸ’áŸáŸá„áŸ—á…áŸ„á›)
                            link = urlMatch[0];
                        } else if (!link.startsWith('http://') && !link.startsWith('https://')) {
                            // á”á¾á¢ááŸ‹á˜á¶á“áŸáŸ„áŸ‡, á‘á¾á”ááŸ‚á˜ https:// á–á¸á˜á»á (á€ášáá¸ www.google.com)
                            link = 'https://' + link;
                        }

                        // á€áŸ‚áŸá˜áŸ’ášá½á›áŸ– á”á¾ Link á“áŸ…ááŸ‚á˜á·á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ (á§. áˆáŸ’á˜áŸ„áŸ‡á•á›á·áá•á›áŸá»á‘áŸ’á’) á€á»áŸ†á”á„áŸ’á á¶á‰á”áŸŠá¼áá»á„
                        if (link.includes('.')) {
                            imgBtn = `<a href="${link}" target="_blank" onclick="event.stopPropagation();" class="w-7 h-7 rounded-lg bg-purple-50 text-purple-600 border border-purple-100 flex items-center justify-center hover:bg-purple-500 hover:text-white transition shadow-sm ml-2" title="á˜á¾á›ášá¼á”á—á¶á–"><i class="fas fa-image text-xs"></i></a>`;
                        }
                    }
                    // [END] á”á‰áŸ’á…á”áŸ‹á€áŸ‚á”áŸ’ášáŸ‚
                    // [END] á”á‰áŸ’á…á”áŸ‹á€áŸ‚á”áŸ’ášáŸ‚

                    // á”á„áŸ’á€á¾áá•áŸ’á“áŸ‚á€ Tracking
                    let trackHtml = '';
                    if (o.trackingNo) {
                        trackHtml = `
                    <div class="mt-2 flex items-center gap-2">
                        <span class="px-2 py-1 rounded-md bg-gray-100 dark:bg-gray-700 text-[10px] font-mono font-bold text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-600 flex items-center gap-1 select-all">
                            <i class="fas fa-barcode text-gray-400"></i> ${o.trackingNo}
                        </span>
                        <button onclick="event.stopPropagation(); navigator.clipboard.writeText('${o.trackingNo}'); ui.showToast('á”á¶á“á…á˜áŸ’á›á„á›áŸá Tracking');" class="text-gray-400 hover:text-blue-500 transition"><i class="far fa-copy text-xs"></i></button>
                    </div>`;
                    }

                    el.innerHTML = `
                <div class="card-strip ${st.strip}"></div>
                <div class="p-5 pl-6">
                    <div class="flex justify-between items-center mb-3">
                        <span class="status-badge ${st.bg} ${st.text}"><i class="fas ${st.icon}"></i> ${st.label}</span>
                        <div class="flex flex-col items-end gap-0.5">
                        <span class="text-[11px] text-gray-400 dark:text-gray-500 font-bold font-sans">${new Date(o.createdAt || o.id).toLocaleDateString('km-KH')}</span>
                        ${o.updatedAt && new Date(o.updatedAt).toDateString() !== new Date(o.createdAt || o.id).toDateString() ? `<span class="text-[9px] text-blue-400 font-sans">Updated: ${new Date(o.updatedAt).toLocaleDateString('km-KH')}</span>` : ''}
                    </div>
                    </div>
                    
                    <div class="mb-3 pb-3 border-b border-gray-100 dark:border-gray-700/50">
                        <h4 class="font-bold text-gray-800 dark:text-white text-lg leading-tight mb-2">${o.custName}</h4>
                        <div class="flex flex-wrap items-center gap-2">
                            <a href="tel:${o.custPhone}" onclick="event.stopPropagation();" class="flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-900/30 hover:bg-emerald-100 transition group-phone">
                                <i class="fas fa-phone-alt text-[10px]"></i> <span class="text-xs font-bold font-mono">${o.custPhone || 'N/A'}</span>
                            </a>
                            <div class="flex items-center gap-1">${(() => { const _url = o.custAddr ? o.custAddr.match(/(https?:\/\/[^\s]+)/) : null; const _txt = o.custAddr ? (o.custAddr.replace(/(https?:\/\/[^\s]+)/g, '').trim() || 'á˜á¾á›á•áŸ‚á“á‘á¸') : 'N/A'; return `<div onclick="event.stopPropagation(); ui.quickViewAddress('${o.custAddr ? o.custAddr.replace(/'/g, "\\'") : ''}')" class="flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 border border-rose-100 dark:border-rose-900/30 hover:bg-rose-100 transition cursor-pointer max-w-[130px]"><i class="fas fa-map-marker-alt text-[10px]"></i><span class="text-xs font-medium truncate">${_txt}</span></div>${_url ? `<a href="${_url[0]}" target="_blank" onclick="event.stopPropagation();" class="flex-shrink-0 w-7 h-7 rounded-lg bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-800 flex items-center justify-center hover:bg-blue-500 hover:text-white transition ml-1" title="á”á¾ Google Maps"><i class="fas fa-directions text-xs"></i></a>` : ''}`; })()}</div>
                        </div>
                    </div>

                    <div class="flex justify-between items-start">
                        <div class="flex-1 pr-2">
                            <div class="flex items-center mb-1">
                                <div class="font-bold text-gray-700 dark:text-gray-200 text-sm line-clamp-1">${o.prodName}</div>
                                ${imgBtn}
                            </div>
                            
                            <div class="flex flex-wrap gap-2">
                                ${o.prodSize ? `<span class="px-2 py-0.5 rounded-md bg-gray-100 dark:bg-gray-700 text-[10px] font-bold text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-600">Size: ${o.prodSize}</span>` : ''}
                                <span class="px-2 py-0.5 rounded-md bg-teal-50 dark:bg-teal-900/30 text-[10px] font-bold text-teal-700 dark:text-teal-400 border border-teal-100 dark:border-teal-800">Qty: ${o.prodQty}</span>
                            </div>

                            ${trackHtml}

                        </div>
                        <div class="text-right flex flex-col items-end">
                            <div class="flex flex-col items-center"> 
                                <div class="font-bold text-xl ${f.profit >= 0 ? 'text-teal-600 dark:text-teal-400' : 'text-red-500'}">${f.profit >= 0 ? '+' : ''}$${f.profit.toFixed(2)}</div>
                                ${app.formatKHR(Math.abs(f.profit), 'sys')}
                            </div>
                        </div>
                    </div>
                    <hr class="border-dashed border-gray-200 dark:border-gray-700/50 my-3">
                    <div class="flex justify-between items-center">
                        <div>${paymentHtml}</div>
                        <div class="flex gap-2">
                            ${messengerBtn}
                            ${o.note ? `<button onclick="event.stopPropagation(); ui.showNote('${o.note.replace(/'/g, "\\'")}')" class="w-8 h-8 rounded-full bg-yellow-50 text-yellow-600 flex items-center justify-center hover:bg-yellow-100 transition border border-yellow-100"><i class="fas fa-sticky-note text-xs"></i></button>` : ''}
                            <button onclick="event.stopPropagation(); ui.confirmDelete(${o.id})" class="w-8 h-8 rounded-full bg-red-50 dark:bg-red-900/20 text-red-500 flex items-center justify-center hover:bg-red-100 transition border border-red-100 dark:border-red-900/30"><i class="fas fa-trash-alt text-xs"></i></button>
                        </div>
                    </div>
                </div>`;

                    container.appendChild(el);
                });
                // [END] á”á‰áŸ’á…á”áŸ‹á€á¶ášá‡áŸ†á“á½áŸá€á¼áŠá”á„áŸ’á€á¾áá€á¶á
            },

            openOrderModal: (id = null) => {
                // áŸ¡. á€áŸ†áááŸ‹á‘á¸áá¶áŸ†á„á¢á€áŸ’áŸáš (Header Text)
                const modalTitle = document.getElementById('modal-title');
                const modalSubtitle = document.getElementById('modal-subtitle');

                history.pushState({ modal: true }, null, '');
                const modal = document.getElementById('modal-order');
                modal.classList.remove('hidden');

                // áŸ¢. á€áŸ†áááŸ‹áá˜áŸ’á›áŸƒá›áŸ†á“á¶áŸ†áŠá¾á˜ (áŸá˜áŸ’ášá¶á”áŸ‹á”á„áŸ’á€á¾áááŸ’á˜á¸ - Create Mode)
                document.getElementById('status').value = 'pending';
                document.getElementById('entry-id').value = '';
                document.getElementById('formStatusIcon').innerText = 'â³';
                document.getElementById('formStatusText').innerText = 'ášá„áŸ‹á…á¶áŸ† (Pending)';

                // ğŸ”¥ á€áŸ†áááŸ‹á¢á€áŸ’áŸášáŸá˜áŸ’ášá¶á”áŸ‹ "á”á„áŸ’á€á¾áááŸ’á˜á¸"
                if (modalTitle) modalTitle.innerText = "á€á¶ášá›á€áŸ‹ááŸ’á˜á¸";
                if (modalSubtitle) modalSubtitle.innerText = "CREATE NEW ORDER";

                // á›á¶á€áŸ‹á”áŸŠá¼áá»á„ Invoice
                document.getElementById('invoice-btn-group').classList.add('hidden');
                document.getElementById('invoice-btn-group').classList.remove('flex');
                // á›á¶á€áŸ‹ Status Log á–áŸá› Create Mode
                const logWrap = document.getElementById('status-log-wrapper');
                if (logWrap) logWrap.classList.add('hidden');

                // áŸá˜áŸ’á¢á¶áá‘á·á“áŸ’á“á“áŸá™á…á¶áŸáŸ‹á€áŸ’á“á»á„ Form
                ['cust-name', 'cust-phone', 'cust-addr', 'cust-fb', 'track-no', 'prod-img', 'prod-name', 'prod-size', 'val-sale', 'val-ship-in', 'cost-buy', 'cost-ship', 'cost-boost', 'note'].forEach(i => document.getElementById(i).value = '');
                document.getElementById('prod-qty').value = '1';
                document.getElementById('inv-rate-input').value = app.config.invRate;

                // áŸ£. á€ášáá¸á€áŸ‚á”áŸ’ášáŸ‚ (Edit Mode)
                if (id) {
                    const o = app.data.find(x => x.id === id);
                    if (o) {
                        // [START] á”á“áŸ’ááŸ‚á˜ááŸ’á˜á¸
                        document.getElementById('track-no').value = o.trackingNo || '';
                        document.getElementById('prod-img').value = o.prodImg || '';
                        // [END]
                        // ğŸ”¥ á€áŸ†áááŸ‹á¢á€áŸ’áŸášáŸá˜áŸ’ášá¶á”áŸ‹ "á€áŸ‚á”áŸ’ášáŸ‚"
                        if (modalTitle) modalTitle.innerText = 'á€áŸ‚á”áŸ’ášáŸ‚á‘á·á“áŸ’á“á“áŸá™';
                        if (modalSubtitle) modalSubtitle.innerText = 'EDIT ORDER DETAILS';

                        document.getElementById('entry-id').value = o.id;
                        document.getElementById('cust-name').value = o.custName;
                        document.getElementById('cust-phone').value = o.custPhone;
                        document.getElementById('cust-addr').value = o.custAddr;
                        document.getElementById('cust-fb').value = o.fbLink || '';
                        document.getElementById('prod-name').value = o.prodName;
                        document.getElementById('prod-size').value = o.prodSize;
                        document.getElementById('prod-qty').value = o.prodQty;
                        document.getElementById('val-sale').value = o.valSale;
                        document.getElementById('val-ship-in').value = o.valShipIn;
                        document.getElementById('cost-buy').value = o.costBuy;
                        document.getElementById('cost-ship').value = o.costShip;
                        document.getElementById('cost-boost').value = o.costBoost;
                        document.getElementById('note').value = o.note || '';
                        const sMap = {
                            'pending': { icon: 'â³', text: 'ášá„áŸ‹á…á¶áŸ† (Pending)' },
                            'ordered': { icon: 'ğŸ›’', text: 'á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹ (Ordered)' },
                            'shipping': { icon: 'ğŸšš', text: 'á€áŸ†á–á»á„áŠá¹á€ (Shipping)' },
                            'completed': { icon: 'âœ…', text: 'á‡áŸ„á‚á‡áŸá™ (Completed)' },
                            'cancelled': { icon: 'âŒ', text: 'á”áŸ„áŸ‡á”á„áŸ‹ (Cancelled)' }
                        };
                        const curS = sMap[o.status] || sMap['pending'];
                        document.getElementById('status').value = o.status;
                        document.getElementById('formStatusIcon').innerText = curS.icon;
                        document.getElementById('formStatusText').innerText = curS.text;
                        document.getElementById('inv-rate-input').value = o.exchangeRate || app.config.invRate;

                        // á”á„áŸ’á á¶á‰á”áŸŠá¼áá»á„ Invoice á–áŸá›á€áŸ‚á”áŸ’ášáŸ‚
                        document.getElementById('invoice-btn-group').classList.remove('hidden');
                        document.getElementById('invoice-btn-group').classList.add('flex');

                        // *** Render Status Log ***
                        const logWrapper = document.getElementById('status-log-wrapper');
                        const logContainer = document.getElementById('status-log-container');
                        const sLabels = {
                            'pending': { icon: 'â³', text: 'ášá„áŸ‹á…á¶áŸ† (Pending)', badge: 'bg-orange-50  dark:bg-orange-900/30  text-orange-600  dark:text-orange-400  border-orange-200  dark:border-orange-700/50' },
                            'ordered': { icon: 'ğŸ›’', text: 'á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹ (Ordered)', badge: 'bg-blue-50    dark:bg-blue-900/30    text-blue-600    dark:text-blue-400    border-blue-200    dark:border-blue-700/50' },
                            'shipping': { icon: 'ğŸšš', text: 'á€áŸ†á–á»á„áŠá¹á€ (Shipping)', badge: 'bg-indigo-50  dark:bg-indigo-900/30  text-indigo-600  dark:text-indigo-400  border-indigo-200  dark:border-indigo-700/50' },
                            'completed': { icon: 'âœ…', text: 'á‡áŸ„á‚á‡áŸá™ (Completed)', badge: 'bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-700/50' },
                            'cancelled': { icon: 'âŒ', text: 'á”áŸ„áŸ‡á”á„áŸ‹ (Cancelled)', badge: 'bg-red-50     dark:bg-red-900/30     text-red-600     dark:text-red-400     border-red-200     dark:border-red-700/50' }
                        };
                        const log = o.statusLog || [];
                        if (log.length > 0 && logWrapper && logContainer) {
                            // áá˜áŸ’ášáŸ€á”á–á¸ Pendingâ†’Completed (á…á¶áŸáŸ‹ â†’ ááŸ’á˜á¸)
                            const sortedLog = [...log].sort((a, b) => new Date(a.time) - new Date(b.time));

                            // Function: Build HTML áŸá˜áŸ’ášá¶á”áŸ‹ Log entries
                            const buildLogHTML = (entries, allEntries) => {
                                const sL = sLabels;
                                let h = '';
                                entries.forEach((entry, i) => {
                                    const s = sL[entry.status] || { icon: 'â€¢', text: entry.status, badge: 'bg-gray-50 text-gray-600 border-gray-200' };
                                    const t = new Date(entry.time);
                                    const dateStr = t.toLocaleDateString('km-KH');
                                    const timeStr = t.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                                    const isLast = i === entries.length - 1;
                                    h += `<div class="flex gap-3 items-start"><div class="flex flex-col items-center flex-shrink-0"><div class="w-8 h-8 rounded-full ${s.badge} border flex items-center justify-center text-sm shadow-sm">${s.icon}</div>${!isLast ? `<div class="w-0.5 min-h-[24px] bg-gradient-to-b from-gray-300 to-gray-100 dark:from-gray-600 dark:to-gray-800 mt-1"></div>` : ''}</div><div class="${!isLast ? 'pb-4' : ''} flex-1 pt-1"><div class="flex justify-between items-center flex-wrap gap-1"><span class="text-sm font-bold text-gray-700 dark:text-gray-200">${s.text}</span><span class="text-[10px] text-gray-400 font-mono bg-white/60 dark:bg-gray-800 px-2 py-0.5 rounded-md border border-gray-100 dark:border-gray-700">${dateStr} Â· ${timeStr}</span></div></div></div>`;
                                });
                                return h;
                            };

                            const needCollapse = sortedLog.length > 3;
                            const collapsed = sortedLog.slice(-3);
                            const hiddenCount = sortedLog.length - 3;

                            const renderLog = (expanded) => {
                                const entries = expanded ? sortedLog : collapsed;
                                let html = '';
                                // à¸›à¸¸à¹ˆà¸¡ Toggle
                                if (needCollapse) {
                                    if (!expanded) {
                                        html += `<button onclick="(function(btn){const lc=btn.closest('[id=\\'status-log-container\\']')||btn.parentElement; renderStatusLogToggle(lc, true);})(this)" class="w-full text-[11px] text-teal-600 dark:text-teal-400 font-bold text-center py-2 mb-3 bg-teal-50/80 dark:bg-teal-900/20 rounded-xl border border-teal-100 dark:border-teal-800 flex items-center justify-center gap-1.5 hover:bg-teal-100 dark:hover:bg-teal-900/40 transition active:scale-95"><i class="fas fa-chevron-up text-[9px]"></i> á˜á¾á›á‘á¶áŸ†á„á¢áŸáŸ‹ (${sortedLog.length}) <i class="fas fa-chevron-up text-[9px]"></i></button>`;
                                    } else {
                                        html += `<button onclick="(function(btn){const lc=btn.closest('[id=\\'status-log-container\\']')||btn.parentElement; renderStatusLogToggle(lc, false);})(this)" class="w-full text-[11px] text-gray-400 font-bold text-center py-2 mb-3 bg-gray-50/80 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700 flex items-center justify-center gap-1.5 hover:bg-gray-100 transition active:scale-95"><i class="fas fa-chevron-down text-[9px]"></i> á”á„áŸ’ášá½á˜ (Collapse) <i class="fas fa-chevron-down text-[9px]"></i></button>`;
                                    }
                                }
                                html += buildLogHTML(entries, sortedLog);
                                return html;
                            };

                            // Store data on container for toggle
                            logContainer._sortedLog = sortedLog;
                            logContainer._sLabels = sLabels;
                            logContainer._buildLogHTML = buildLogHTML;

                            window.renderStatusLogToggle = (container, expanded) => {
                                const sl = container._sortedLog;
                                const needC = sl.length > 3;
                                const col = sl.slice(-3);
                                const entries = expanded ? sl : col;
                                const sL = {
                                    'pending': { icon: 'â³', text: 'ášá„áŸ‹á…á¶áŸ† (Pending)', badge: 'bg-orange-50  dark:bg-orange-900/30  text-orange-600  dark:text-orange-400  border-orange-200  dark:border-orange-700/50' },
                                    'ordered': { icon: 'ğŸ›’', text: 'á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹ (Ordered)', badge: 'bg-blue-50    dark:bg-blue-900/30    text-blue-600    dark:text-blue-400    border-blue-200    dark:border-blue-700/50' },
                                    'shipping': { icon: 'ğŸšš', text: 'á€áŸ†á–á»á„áŠá¹á€ (Shipping)', badge: 'bg-indigo-50  dark:bg-indigo-900/30  text-indigo-600  dark:text-indigo-400  border-indigo-200  dark:border-indigo-700/50' },
                                    'completed': { icon: 'âœ…', text: 'á‡áŸ„á‚á‡áŸá™ (Completed)', badge: 'bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-700/50' },
                                    'cancelled': { icon: 'âŒ', text: 'á”áŸ„áŸ‡á”á„áŸ‹ (Cancelled)', badge: 'bg-red-50     dark:bg-red-900/30     text-red-600     dark:text-red-400     border-red-200     dark:border-red-700/50' }
                                };
                                let html = '';
                                if (needC) {
                                    if (!expanded) {
                                        html += `<button onclick="(function(btn){const lc=document.getElementById('status-log-container'); renderStatusLogToggle(lc, true);})(this)" class="w-full text-[11px] text-teal-600 dark:text-teal-400 font-bold text-center py-2 mb-3 bg-teal-50/80 dark:bg-teal-900/20 rounded-xl border border-teal-100 dark:border-teal-800 flex items-center justify-center gap-1.5 hover:bg-teal-100 dark:hover:bg-teal-900/40 transition active:scale-95"><i class="fas fa-chevron-up text-[9px]"></i> á˜á¾á›á‘á¶áŸ†á„á¢áŸáŸ‹ (${sl.length}) <i class="fas fa-chevron-up text-[9px]"></i></button>`;
                                    } else {
                                        html += `<button onclick="(function(btn){const lc=document.getElementById('status-log-container'); renderStatusLogToggle(lc, false);})(this)" class="w-full text-[11px] text-gray-400 font-bold text-center py-2 mb-3 bg-gray-50/80 dark:bg-gray-800/50 rounded-xl border border-gray-100 dark:border-gray-700 flex items-center justify-center gap-1.5 hover:bg-gray-100 transition active:scale-95"><i class="fas fa-chevron-down text-[9px]"></i> á”á„áŸ’ášá½á˜ (Collapse) <i class="fas fa-chevron-down text-[9px]"></i></button>`;
                                    }
                                }
                                entries.forEach((entry, i) => {
                                    const s = sL[entry.status] || { icon: 'â€¢', text: entry.status, badge: 'bg-gray-50 text-gray-600 border-gray-200' };
                                    const t = new Date(entry.time);
                                    const dateStr = t.toLocaleDateString('km-KH');
                                    const timeStr = t.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                                    const isLast = i === entries.length - 1;
                                    html += `<div class="flex gap-3 items-start"><div class="flex flex-col items-center flex-shrink-0"><div class="w-8 h-8 rounded-full ${s.badge} border flex items-center justify-center text-sm shadow-sm">${s.icon}</div>${!isLast ? `<div class="w-0.5 min-h-[24px] bg-gradient-to-b from-gray-300 to-gray-100 dark:from-gray-600 dark:to-gray-800 mt-1"></div>` : ''}</div><div class="${!isLast ? 'pb-4' : ''} flex-1 pt-1"><div class="flex justify-between items-center flex-wrap gap-1"><span class="text-sm font-bold text-gray-700 dark:text-gray-200">${s.text}</span><span class="text-[10px] text-gray-400 font-mono bg-white/60 dark:bg-gray-800 px-2 py-0.5 rounded-md border border-gray-100 dark:border-gray-700">${dateStr} Â· ${timeStr}</span></div></div></div>`;
                                });
                                container.innerHTML = html;
                            };

                            logContainer.innerHTML = renderLog(false);
                            logWrapper.classList.remove('hidden');

                            // Build full HTML for expand
                            let fullHtml = '';
                            sortedLog.forEach((entry, i) => {
                                const s = sLabels[entry.status] || { icon: 'â€¢', text: entry.status, badge: 'bg-gray-50 text-gray-600 border-gray-200' };
                                const t = new Date(entry.time);
                                const dateStr = t.toLocaleDateString('km-KH');
                                const timeStr = t.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                                const isLast = i === sortedLog.length - 1;
                                fullHtml += `<div class="flex gap-3 items-start"><div class="flex flex-col items-center flex-shrink-0"><div class="w-8 h-8 rounded-full ${s.badge} border flex items-center justify-center text-sm shadow-sm">${s.icon}</div>${!isLast ? `<div class="w-0.5 min-h-[24px] bg-gradient-to-b from-gray-300 to-gray-100 dark:from-gray-600 dark:to-gray-800 mt-1"></div>` : ''}</div><div class="${!isLast ? 'pb-4' : ''} flex-1 pt-1"><div class="flex justify-between items-center flex-wrap gap-1"><span class="text-sm font-bold text-gray-700 dark:text-gray-200">${s.text}</span><span class="text-[10px] text-gray-400 font-mono bg-white/60 dark:bg-gray-800 px-2 py-0.5 rounded-md border border-gray-100 dark:border-gray-700">${dateStr} Â· ${timeStr}</span></div></div></div>`;
                            });
                            logContainer.setAttribute('data-full', fullHtml);
                            logContainer.innerHTML = html;
                            logWrapper.classList.remove('hidden');
                        } else if (logWrapper) {
                            logWrapper.classList.add('hidden');
                        }
                    }
                }
            },
            closeModal: (id) => document.getElementById(id).classList.add('hidden'),

            saveOrder: async () => {
                try {
                    const idStr = document.getElementById('entry-id').value;
                    const custName = document.getElementById('cust-name').value;
                    const prodName = document.getElementById('prod-name').value;

                    if (!custName || !prodName) {
                        alert("áŸá¼á˜á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡á¢áá·áá·á‡á“ á“á·á„áˆáŸ’á˜áŸ„áŸ‡á‘áŸ†á“á·á‰!");
                        return;
                    }

                    const curRate = parseInt(document.getElementById('inv-rate-input').value) || 4100;
                    app.config.invRate = curRate;
                    app.saveConfig();

                    // === [á…áŸ†áá»á…á€áŸ‚á”áŸ’ášáŸ‚áŸáŸ†áá¶á“áŸ‹] ===
                    // ášá€áŸ’áŸá¶á‘á»á€á€á¶á›á”ášá·á…áŸ’á†áŸá‘á…á¶áŸáŸ‹á”áŸ’ášáŸá·á“á”á¾áœá¶á‡á¶á€á¶ášá€áŸ‚á”áŸ’ášáŸ‚á‘á·á“áŸ’á“á“áŸá™ (Edit)
                    const now = new Date().toISOString();
                    let createdAt = now;
                    let statusLog = [];
                    const newStatus = document.getElementById('status').value;

                    if (idStr) {
                        const existingOrder = app.data.find(x => x.id === parseInt(idStr));
                        if (existingOrder) {
                            // createdAt á˜á·á“á•áŸ’á›á¶áŸáŸ‹á”áŸ’áŠá¼áš â€” á”áŸ’ášá¾ id á‡á¶ fallback áŸá˜áŸ’ášá¶á”áŸ‹ Order á…á¶áŸáŸ‹
                            createdAt = existingOrder.createdAt || new Date(existingOrder.id).toISOString();
                            statusLog = Array.isArray(existingOrder.statusLog) ? [...existingOrder.statusLog] : [];
                            // á”á“áŸ’ááŸ‚á˜ Log ááŸ‚ á–áŸá› Status á•áŸ’á›á¶áŸáŸ‹á”áŸ’áŠá¼áš
                            const lastLogStatus = statusLog.length > 0 ? statusLog[statusLog.length - 1].status : null;
                            if (newStatus !== lastLogStatus) {
                                statusLog.push({ status: newStatus, time: now });
                            }
                        }
                    } else {
                        // Order ááŸ’á˜á¸ â€” Log áŠáŸ†á”á¼á„
                        statusLog = [{ status: newStatus, time: now }];
                    }

                    const payload = {
                        id: idStr ? parseInt(idStr) : Date.now(),
                        createdAt: createdAt,
                        updatedAt: now,
                        exchangeRate: curRate,
                        trackingNo: document.getElementById('track-no').value,
                        prodImg: document.getElementById('prod-img').value,
                        fbLink: document.getElementById('cust-fb').value,
                        custName: custName,
                        custPhone: document.getElementById('cust-phone').value,
                        custAddr: document.getElementById('cust-addr').value,
                        prodName: prodName,
                        prodSize: document.getElementById('prod-size').value,
                        // á”áŸ†á”áŸ’á›áŸ‚á„á…áŸ†á“á½á“á‘áŸ†á“á·á‰á‡á¶á›áŸáá‡á¶á“á·á…áŸ’á… áŠá¾á˜áŸ’á”á¸á€á¶ášá–á¶áš Error á–áŸá›á”á¼á€ášá”á¶á™á€á¶ášááŸ
                        prodQty: parseInt(document.getElementById('prod-qty').value) || 1,
                        valSale: document.getElementById('val-sale').value,
                        valShipIn: document.getElementById('val-ship-in').value,
                        costBuy: document.getElementById('cost-buy').value,
                        costShip: document.getElementById('cost-ship').value,
                        costBoost: document.getElementById('cost-boost').value,
                        note: document.getElementById('note').value,
                        status: document.getElementById('status').value,
                        statusLog: statusLog,
                        statusLog: statusLog,
                        isDeleted: false
                    };

                    const existingIdx = app.data.findIndex(x => x.id === payload.id);
                    if (existingIdx > -1) {
                        app.data[existingIdx] = payload;
                    } else {
                        app.data.unshift(payload);
                    }

                    app.data.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));

                    ui.renderHome();
                    ui.renderStats();
                    ui.renderHistory();
                    ui.closeModal('modal-order');
                    ui.showToast('âœ… ášá€áŸ’áŸá¶á‘á»á€á‡áŸ„á‚á‡áŸá™');

                    await db.put(payload);

                } catch (e) {
                    alert("Error: " + e);
                }
            },

            confirmType: null, confirmId: null,
            askConfirm: (type, id = null) => {
                ui.confirmType = type; ui.confirmId = id;
                const modal = document.getElementById('modal-confirm-overlay');
                const title = document.getElementById('confirm-title'); const desc = document.getElementById('confirm-desc'); const iconBox = document.getElementById('confirm-icon-box'); const icon = document.getElementById('confirm-icon'); const btn = document.getElementById('btn-confirm-yes');
                iconBox.className = 'w-14 h-14 rounded-full flex items-center justify-center mx-auto mb-4';

                if (type === 'delete') { title.innerText = 'á›á»á”á€á¶ášá›á€áŸ‹á“áŸáŸ‡?'; desc.innerText = 'á‘á·á“áŸ’á“áŸá™á“á¹á„ááŸ’ášá¼áœá”á¶á“á•áŸ’á›á¶áŸáŸ‹á‘á¸á‘áŸ…á’á»á„áŸáŸ†ášá¶á˜áŸ”'; icon.className = 'fas fa-trash-alt text-2xl'; iconBox.classList.add('bg-red-100', 'text-red-500', 'dark:bg-red-900/30'); btn.className = 'flex-1 py-3 rounded-xl bg-red-600 text-white font-bold text-sm shadow-lg shadow-red-200 dark:shadow-none hover:bg-red-700 transition'; btn.innerText = 'á™á›áŸ‹á–áŸ’ášá˜'; }
                else if (type === 'restore') { title.innerText = 'áŸáŸ’áá¶ášá‘á·á“áŸ’á“áŸá™áœá·á‰?'; desc.innerText = 'á‘á·á“áŸ’á“áŸá™á“á¹á„ááŸ’ášá¡á”áŸ‹á‘áŸ…á”á‰áŸ’á‡á¸á€á¶ášá›á€áŸ‹áœá·á‰áŸ”'; icon.className = 'fas fa-undo text-2xl'; iconBox.classList.add('bg-teal-100', 'text-teal-600', 'dark:bg-teal-900/30'); btn.className = 'flex-1 py-3 rounded-xl bg-teal-600 text-white font-bold text-sm shadow-lg shadow-teal-200 dark:shadow-none hover:bg-teal-700 transition'; btn.innerText = 'áŸáŸ’áá¶ášáœá·á‰'; }
                else if (type === 'empty_trash') { title.innerText = 'áŸá˜áŸ’á¢á¶áá’á»á„áŸáŸ†ášá¶á˜?'; desc.innerText = 'á‘á·á“áŸ’á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹á“á¹á„á”á¶ááŸ‹á”á„áŸ‹á‡á¶áŸáŸ’áá¶á–áš! á˜á·á“á¢á¶á…á™á€áœá·á‰á”á¶á“á‘áŸáŸ”'; icon.className = 'fas fa-fire text-2xl'; iconBox.classList.add('bg-orange-100', 'text-orange-600', 'dark:bg-orange-900/30'); btn.className = 'flex-1 py-3 rounded-xl bg-orange-600 text-white font-bold text-sm shadow-lg shadow-orange-200 dark:shadow-none hover:bg-orange-700 transition'; btn.innerText = 'áŸá˜áŸ’á¢á¶á'; }
                else if (type === 'reset_app') { title.innerText = 'âš ï¸ RESET APPLICATION?'; desc.innerHTML = 'áŸá€á˜áŸ’á˜á—á¶á–á“áŸáŸ‡á“á¹á„á›á»á”á…áŸ„á›á‘á·á“áŸ’á“áŸá™á‘á¶áŸ†á„á¢áŸáŸ‹!<br>á á¾á™á˜á·á“á¢á¶á…ááŸ’ášá¡á”áŸ‹á€áŸ’ášáŸ„á™á”á¶á“á‘áŸáŸ”'; icon.className = 'fas fa-radiation text-3xl animate-pulse'; iconBox.classList.add('bg-red-600', 'text-white', 'shadow-xl', 'shadow-red-400'); btn.className = 'flex-1 py-3 rounded-xl bg-red-600 text-white font-bold text-sm shadow-xl shadow-red-300 dark:shadow-none hover:bg-red-700 transition border-2 border-white'; btn.innerText = 'á›á»á”á…áŸ„á›á‘á¶áŸ†á„á¢áŸáŸ‹'; }
                modal.classList.remove('hidden');
            },
            closeConfirm: () => { ui.confirmType = null; ui.confirmId = null; document.getElementById('modal-confirm-overlay').classList.add('hidden'); },
            onConfirmYes: async () => {
                const type = ui.confirmType; const id = ui.confirmId; ui.closeConfirm();
                if (type === 'delete' && id) { const item = app.data.find(x => x.id === id); if (item) { item.isDeleted = true; ui.renderHome(); ui.showToast('ğŸ—‘ï¸ á”á¶á“á›á»á”á‘áŸ…á’á»á„áŸáŸ†ášá¶á˜'); await db.put(item); ui.closeModal('modal-order'); } }
                else if (type === 'restore' && id) { const item = app.data.find(x => x.id === id); if (item) { item.isDeleted = false; ui.renderTrashList(); ui.renderHome(); ui.renderStats(); ui.showToast('â™»ï¸ á”á¶á“á™á€á˜á€áœá·á‰'); await db.put(item); } }
                else if (type === 'empty_trash') { const trash = app.data.filter(x => x.isDeleted); app.data = app.data.filter(x => !x.isDeleted); ui.renderTrashList(); ui.showToast('ğŸ§¹ áŸá˜áŸ’á¢á¶áá’á»á„áŸáŸ†ášá¶á˜ášá½á…ášá¶á›áŸ‹!'); for (let t of trash) { await db.delete(t.id); } }
                else if (type === 'reset_app') { document.getElementById('app-loader').style.display = 'flex'; document.getElementById('loader-text').innerText = "á€áŸ†á–á»á„á›á»á”á…áŸ„á›á‘á·á“áŸ’á“áŸá™..."; await db.clear(); localStorage.clear(); setTimeout(() => { location.reload(); }, 1500); }
            },

            confirmDelete: (id) => ui.askConfirm('delete', id),
            openTrashModal: async (fetchFromDB = false) => { history.pushState({ modal: true }, null, ''); if (fetchFromDB) await app.refresh(); document.getElementById('modal-trash').classList.remove('hidden'); ui.renderTrashList(); },
            renderTrashList: () => {
                const list = document.getElementById('trash-list'); list.innerHTML = ''; const deleted = app.data.filter(o => o.isDeleted);
                if (deleted.length === 0) list.innerHTML = '<div class="text-center mt-20 text-gray-400"><i class="fas fa-trash-alt text-4xl mb-2"></i><p>á’á»á„áŸáŸ†ášá¶á˜áŸáŸ’á¢á¶á</p></div>';
                deleted.forEach(o => { const d = document.createElement('div'); d.className = 'bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-4 rounded-xl flex justify-between items-center'; d.innerHTML = `<div><h4 class="font-bold text-gray-700 dark:text-gray-200 text-lg mb-1">${o.prodName}</h4><p class="text-sm text-gray-500 font-sans">${new Date(o.updatedAt).toLocaleDateString()}</p></div><button onclick="ui.restore(${o.id})" class="px-4 py-2 bg-teal-100 text-teal-800 text-sm font-bold rounded-lg hover:bg-teal-200 transition"><i class="fas fa-undo mr-1"></i> Restore</button>`; list.appendChild(d); });
            },
            restore: (id) => ui.askConfirm('restore', id),

            openInvoice: (type) => {
                history.pushState({ modal: true }, null, '');
                const id = parseInt(document.getElementById('entry-id').value); const o = app.data.find(x => x.id === id); if (!o) return;
                const f = app.calc(o); const rate = o.exchangeRate || app.config.invRate;
                const khrText = new Intl.NumberFormat('km-KH').format(Math.round(f.income * rate)); const viewer = document.getElementById('invoice-viewer');

                const signatureSection = type === 'admin' ? '' : `<div class="flex justify-between items-end mt-14 px-4"><div class="text-center"><div class="border-b border-gray-300 w-24 mb-2"></div><span class="text-[9px] font-bold text-gray-600">á¢áŸ’á“á€á‘á‘á½á›</span></div><div class="text-center"><div class="border-b border-gray-300 w-24 mb-2"></div><span class="text-[9px] font-bold text-gray-600">á¢áŸ’á“á€á›á€áŸ‹</span></div></div>`;

                let html = `<div id="invoice-capture" class="bg-white p-6 relative overflow-hidden" style="font-family: 'Battambang', sans-serif;"><div class="absolute top-0 left-0 w-full h-1.5 bg-teal-600"></div><div class="text-center mb-6 border-b border-teal-500 pb-3"><h2 class="text-xl font-bold text-teal-700">áœá·á€áŸ’á€á™á”ááŸ’áš</h2><p class="text-[9px] text-gray-500 uppercase tracking-widest mt-0.5">INVOICE #${o.id.toString().slice(-6)}</p><p class="text-[9px] text-gray-400 mt-0.5">${new Date().toLocaleString('km-KH')}</p></div><div class="flex justify-between text-[10px] mb-6 gap-2"><div class="text-left flex-1 pr-2"><span class="text-teal-600 font-bold block text-[8px] uppercase mb-0.5">Bill To:</span><span class="font-bold text-gray-800 text-[10px] block mb-0.5 line-clamp-1">${o.custName}</span><div class="text-gray-500 leading-tight text-[9px]">${o.custPhone}</div><div class="text-gray-500 leading-tight mt-0.5 break-words text-[9px]">${o.custAddr || '-'}</div></div><div class="text-right w-auto pl-2 whitespace-nowrap"><span class="text-teal-600 font-bold block text-[8px] uppercase mb-0.5">From:</span><span class="font-bold text-gray-800 text-[10px] block mb-0.5">Bosba Ladies Dress</span><div class="text-gray-500 leading-tight text-[9px]">Phnom Penh, Cambodia</div></div></div><div class="mb-4"><div class="flex justify-between bg-teal-50 p-1.5 rounded-t border-b border-teal-100"><span class="text-[9px] font-bold text-teal-700 uppercase">á”ášá·á™á¶á™ (Description)</span><span class="text-[9px] font-bold text-teal-700 uppercase">áá˜áŸ’á›áŸƒ (Price)</span></div><div class="flex justify-between items-start p-2 border-b border-gray-100"><div><div class="text-[10px] font-bold text-gray-800">${o.prodName}</div><div class="text-[9px] text-gray-500 mt-0.5">Size: ${o.prodSize || '-'} | Qty: ${o.prodQty}</div></div><div class="text-[10px] font-bold text-gray-800">$${f.sale.toFixed(2)}</div></div></div><div class="flex justify-end mb-4"><div class="w-1/2 space-y-1 text-right"><div class="flex justify-between text-[9px] text-gray-600 px-1"><span>áŸášá»á”ášá„:</span><span class="font-medium">$${f.sale.toFixed(2)}</span></div><div class="flex justify-between text-[9px] text-gray-600 px-1"><span>ááŸ’á›áŸƒáŠá¹á€:</span><span class="font-medium">$${f.shipIn.toFixed(2)}</span></div><div class="flex justify-between items-center text-[11px] font-bold text-teal-800 mt-1 pt-1 border-t border-teal-100 bg-teal-50 px-2 py-1 rounded"><span>áŸášá»á”ášá½á˜:</span><span>$${f.income.toFixed(2)}</span></div><div class="text-right text-[9px] text-gray-500 font-bold" style="line-height:1; margin-top:2px;">(${khrText} áŸ›)</div></div></div></div>${type === 'admin' ? `<div class="mt-4 pt-2 border-t border-red-100 bg-red-50 p-2 rounded border-dashed"><h4 class="text-center text-[8px] font-bold text-red-400 uppercase tracking-widest mb-1">INTERNAL USE ONLY</h4><div class="grid grid-cols-2 gap-1 text-[9px] text-gray-600"><div>ááŸ’á›áŸƒáŠá¾á˜: <b>$${f.cogs.toFixed(2)}</b></div><div>áŠá¹á€á…áŸá‰: <b>$${f.shipExp.toFixed(2)}</b></div><div>Ads: <b>$${f.boost.toFixed(2)}</b></div><div>á…áŸ†áá¶á™áŸášá»á”: <b class="text-red-500">$${f.expense.toFixed(2)}</b></div></div><div class="mt-1 text-center border-t border-red-200 pt-1"><span class="text-[9px] font-bold text-gray-500">á”áŸ’ášá¶á€áŸ‹á…áŸ†ááŸá‰</span><div class="text-xs font-bold ${f.profit >= 0 ? 'text-green-600' : 'text-red-600'}">$${f.profit.toFixed(2)}</div></div></div>` : `${signatureSection}<div class="text-center mt-10 pt-4 border-t border-gray-100"><p class="text-[9px] text-gray-500 font-serif-kh">á¢ášá‚á»ááŠáŸ‚á›á”á¶á“á‚á¶áŸ†á‘áŸ’ášá¢á¶á‡á¸áœá€á˜áŸ’á˜á–á½á€á™á¾á„!</p></div>`}</div>`;
                viewer.innerHTML = html; document.getElementById('invoice-modal').classList.remove('hidden');
            },

            shareTextOrder: async () => {
                const cName = document.getElementById('cust-name').value;
                const cPhone = document.getElementById('cust-phone').value;
                const cAddr = document.getElementById('cust-addr').value;
                const pName = document.getElementById('prod-name').value;
                const pSize = document.getElementById('prod-size').value;
                const pQty = document.getElementById('prod-qty').value;
                const trackNo = document.getElementById('track-no').value;
                const vSale = parseFloat(document.getElementById('val-sale').value) || 0;
                const vShip = parseFloat(document.getElementById('val-ship-in').value) || 0;
                const total = vSale + vShip;
                const status = document.getElementById('status').value;
                const now = new Date();
                const dateStr = now.toLocaleDateString('km-KH', { year: 'numeric', month: 'long', day: 'numeric' });
                const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                const statusMap = {
                    'pending': 'â³ ášá„áŸ‹á…á¶áŸ† (Pending)',
                    'ordered': 'ğŸ›’ á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹ (Ordered)',
                    'shipping': 'ğŸšš á€áŸ†á–á»á„áŠá¹á€ (Shipping)',
                    'completed': 'âœ… á‡áŸ„á‚á‡áŸá™ (Completed)',
                    'cancelled': 'âŒ á”áŸ„áŸ‡á”á„áŸ‹ (Cancelled)'
                };
                const addrUrlMatch = cAddr ? cAddr.match(/(https?:\/\/[^\s]+)/) : null;
                const addrText = cAddr ? cAddr.replace(/(https?:\/\/[^\s]+)/g, '').trim() : 'N/A';
                const addrLine = addrText + (addrUrlMatch ? '\n     ğŸ—ºï¸ ' + addrUrlMatch[0] : '');
                const lines = [
                    'ğŸ“¦ áœá·á€áŸ’á€á™á”ááŸ’áš / ORDER DETAIL',
                    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
                    'ğŸ“… á€á¶á›á”ášá·á…áŸ’á†áŸá‘: ' + dateStr + ' Â· ' + timeStr,
                    'ğŸ”– áŸáŸ’áá¶á“á—á¶á–: ' + (statusMap[status] || status),
                    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
                    'ğŸ‘¤ á¢áá·áá·á‡á“: ' + (cName || 'N/A'),
                    'ğŸ“ á‘á¼ášáŸáŸá–áŸ’á‘: ' + (cPhone || 'N/A'),
                    'ğŸ“ á‘á¸áá¶áŸ†á„: ' + addrLine,
                    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
                    'ğŸ›ï¸ á‘áŸ†á“á·á‰: ' + (pName || 'N/A'),
                    ...(pSize ? ['ğŸ“ á‘áŸ†á áŸ† (Size): ' + pSize] : []),
                    'ğŸ”¢ á…áŸ†á“á½á“ (Qty): ' + (pQty || 1),
                    ...(trackNo ? ['ğŸ“¬ Tracking: ' + trackNo] : []),
                    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
                    'ğŸ’µ áá˜áŸ’á›áŸƒá‘áŸ†á“á·á‰: $' + vSale.toFixed(2),
                    'ğŸšš ááŸ’á›áŸƒáŠá¹á€: $' + vShip.toFixed(2),
                    'ğŸ’° áŸášá»á”á‘á¼á‘á¶ááŸ‹: $' + total.toFixed(2),
                    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”',
                    'ğŸ™ á¢ášá‚á»ááŠáŸ‚á›á”á¶á“á‚á¶áŸ†á‘áŸ’áš! Thank you!'
                ];
                const text = lines.join('\n');
                if (navigator.share) {
                    try { await navigator.share({ title: 'Order Details', text: text }); } catch (e) { }
                } else {
                    navigator.clipboard.writeText(text);
                    ui.showToast('ğŸ“‹ á”á¶á“á…á˜áŸ’á›á„á¢á€áŸ’áŸášáœá·á€áŸ’á€á™á”ááŸ’áš!');
                }
            },
            renderSettingsRate: () => {
                const el = document.getElementById('sys-rate-input');
                if (el) {
                    el.value = app.config.sysRate;
                    document.getElementById('sys-rate-mode').checked = (app.config.sysMode === 'auto');
                    el.disabled = (app.config.sysMode === 'auto');
                }
            },
            updateSysRate: (val) => {
                app.config.sysRate = parseInt(val) || 4100;
                app.saveConfig(); app.refresh();
            },
            toggleSysRateMode: () => {
                const isAuto = document.getElementById('sys-rate-mode').checked;
                app.config.sysMode = isAuto ? 'auto' : 'manual';
                document.getElementById('sys-rate-input').disabled = isAuto;
                if (isAuto) {
                    ui.showToast("ğŸ”„ Fetching...");
                    setTimeout(() => {
                        app.config.sysRate = 4100;
                        app.saveConfig(); app.refresh(); ui.renderSettingsRate();
                        ui.showToast("âœ… Updated");
                    }, 1000);
                } else { app.saveConfig(); }
            },
            dataManager: {
                downloadBackup: () => {
                    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(app.data));
                    const dlAnchorElem = document.createElement('a'); dlAnchorElem.setAttribute("href", dataStr); dlAnchorElem.setAttribute("download", `shop_backup_${new Date().toISOString().slice(0, 10)}.json`); document.body.appendChild(dlAnchorElem); dlAnchorElem.click(); dlAnchorElem.remove(); ui.showToast("âœ… á”á¶á“ Download á¯á€áŸá¶áš Backup!");
                },
                prepareImport: (input) => { const file = input.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const content = e.target.result; let importedData = []; if (file.name.toLowerCase().endsWith('.json')) importedData = JSON.parse(content); else if (file.name.toLowerCase().endsWith('.csv')) importedData = dataManager.parseCSV(content); else throw new Error("Format not supported"); if (!Array.isArray(importedData) || importedData.length === 0) throw new Error("No data found"); ui.showImportConfirm(importedData.length, importedData); input.value = ''; } catch (err) { alert("Error: " + err.message); } }; reader.readAsText(file); },
                executeImport: async (data) => { document.getElementById('modal-import-overlay').classList.add('hidden'); const loader = document.getElementById('app-loader'); loader.style.display = 'flex'; document.getElementById('loader-text').innerText = "á€áŸ†á–á»á„á”á‰áŸ’á…á¼á›á‘á·á“áŸ’á“áŸá™..."; try { const tx = dbConn.transaction(DB_CONFIG.store, 'readwrite'); const store = tx.objectStore(DB_CONFIG.store); data.forEach(item => store.put(item)); tx.oncomplete = async () => { await app.refresh(); loader.style.display = 'none'; ui.showToast(`âœ… á”á‰áŸ’á…á¼á› ${data.length} á‘á·á“áŸ’á“áŸá™á‡áŸ„á‚á‡áŸá™!`); }; tx.onerror = (e) => { throw new Error(e.target.error); }; } catch (err) { loader.style.display = 'none'; alert("Import Failed: " + err); } },
                parseCSV: (text) => {
                    const lines = text.split('\n').filter(l => l.trim() !== '');
                    const data = [];

                    const headerLine = lines[0].toLowerCase();
                    const isNewFormat = headerLine.includes('date(iso)') && headerLine.includes('tracking no');

                    for (let i = 1; i < lines.length; i++) {
                        const values = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                        if (!values) continue;
                        const cleanVal = (val) => val ? val.replace(/^"|"$/g, '').replace(/""/g, '"').trim() : '';

                        if (isNewFormat && values.length >= 18) {
                            const rawDate = cleanVal(values[1]);
                            let parsedDate = new Date().toISOString();
                            if (rawDate) {
                                const d = new Date(rawDate);
                                if (!isNaN(d.getTime())) parsedDate = d.toISOString();
                            }

                            const row = {
                                id: cleanVal(values[0]) ? parseInt(cleanVal(values[0])) : (Date.now() + Math.random()),
                                updatedAt: parsedDate,
                                custName: cleanVal(values[2]),
                                custPhone: cleanVal(values[3]),
                                custAddr: cleanVal(values[4]),
                                fbLink: cleanVal(values[5]),
                                prodName: cleanVal(values[6]),
                                prodSize: cleanVal(values[7]),
                                prodQty: parseInt(cleanVal(values[8])) || 1,
                                trackingNo: cleanVal(values[9]),
                                prodImg: cleanVal(values[10]),
                                valSale: parseFloat(cleanVal(values[11])) || 0,
                                valShipIn: parseFloat(cleanVal(values[12])) || 0,
                                costBuy: parseFloat(cleanVal(values[13])) || 0,
                                costShip: parseFloat(cleanVal(values[14])) || 0,
                                costBoost: parseFloat(cleanVal(values[15])) || 0,
                                exchangeRate: parseInt(cleanVal(values[16])) || 4100,
                                status: cleanVal(values[17]) || 'pending',
                                note: cleanVal(values[18]) || '',
                                isDeleted: false
                            };
                            data.push(row);
                        } else {
                            let parsedDate = new Date().toISOString();
                            if (values[12]) {
                                const d = new Date(cleanVal(values[12]));
                                if (!isNaN(d.getTime())) parsedDate = d.toISOString();
                            }
                            const row = {
                                id: Date.now() + Math.random(),
                                updatedAt: parsedDate,
                                custName: cleanVal(values[1]),
                                custPhone: cleanVal(values[2]),
                                custAddr: cleanVal(values[3]),
                                prodName: cleanVal(values[4]),
                                prodSize: cleanVal(values[5]),
                                prodQty: parseInt(cleanVal(values[6])) || 1,
                                valSale: parseFloat(cleanVal(values[8])) || 0,
                                valShipIn: 0, costBuy: 0, costShip: 0, costBoost: 0,
                                status: cleanVal(values[10]) || 'pending',
                                note: cleanVal(values[11]) || '',
                                isDeleted: false
                            };
                            data.push(row);
                        }
                    }
                    return data;
                },

                exportCSV: () => {
                    const items = app.data;
                    if (items.length === 0) { ui.showToast("âš ï¸ á‚áŸ’á˜á¶á“á‘á·á“áŸ’á“áŸá™áŸá˜áŸ’ášá¶á”áŸ‹ Export"); return; }

                    let csvContent = "\uFEFFID,Date(ISO),Customer,Phone,Address,FB Link,Product,Size,Qty,Tracking No,Image URL,Sale Price,Shipping In,Cost Buy,Shipping Out,Boost Ads,Exchange Rate,Status,Note\n";

                    const q = (s) => {
                        if (s === null || s === undefined) return '""';
                        return `"${s.toString().replace(/"/g, '""')}"`;
                    };

                    items.forEach(o => {
                        const row = [
                            q(o.id),
                            q(o.updatedAt),
                            q(o.custName),
                            q(o.custPhone),
                            q(o.custAddr),
                            q(o.fbLink || ''),
                            q(o.prodName),
                            q(o.prodSize),
                            q(o.prodQty),
                            q(o.trackingNo || ''),
                            q(o.prodImg || ''),
                            q(o.valSale || 0),
                            q(o.valShipIn || 0),
                            q(o.costBuy || 0),
                            q(o.costShip || 0),
                            q(o.costBoost || 0),
                            q(o.exchangeRate || app.config.sysRate),
                            q(o.status),
                            q(o.note || '')
                        ].join(",");
                        csvContent += row + "\n";
                    });

                    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement("a");
                    const url = URL.createObjectURL(blob);
                    link.setAttribute("href", url);
                    const today = new Date().toISOString().slice(0, 10);
                    link.setAttribute("download", `Shop_Data_Backup_${today}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                },
                resetApp: () => { ui.askConfirm('reset_app'); }, emptyTrash: () => ui.askConfirm('empty_trash')
            }

        };
        ui.showImportConfirm = (count, data) => { document.getElementById('import-msg-count').innerText = `á”á¶á“ášá€áƒá¾á‰ ${count} á‘á·á“áŸ’á“áŸá™`; const modal = document.getElementById('modal-import-overlay'); const btn = document.getElementById('btn-confirm-import'); const newBtn = btn.cloneNode(true); btn.parentNode.replaceChild(newBtn, btn); newBtn.onclick = () => dataManager.executeImport(data); modal.classList.remove('hidden'); };

        const dataManager = ui.dataManager;

        function renderProfessionalHistory() {
            const container = document.getElementById('history-list-container');
            const countBadge = document.getElementById('hist-total-count');
            const allData = app.data || []; const activeData = allData.filter(x => !x.isDeleted); const sorted = [...activeData].sort((a, b) => b.id - a.id);
            if (countBadge) countBadge.innerText = `${sorted.length} á”áŸ’ášáá·á”ááŸ’áá·á€á¶áš`;

            if (sorted.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center mt-20 animate-fade-in">
                        <div class="w-20 h-20 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4 shadow-inner">
                            <i class="fas fa-history text-3xl text-gray-300 dark:text-gray-600"></i>
                        </div>
                        <h3 class="font-bold text-gray-400 dark:text-gray-500">á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á‘á·á“áŸ’á“á“áŸá™</h3>
                        <p class="text-xs text-gray-400 mt-1">á‘á·á“áŸ’á“á“áŸá™ášá”áŸáŸ‹á¢áŸ’á“á€á“á¹á„á”á„áŸ’á á¶á‰á“áŸ…á‘á¸á“áŸáŸ‡</p>
                    </div>`;
                return;
            }

            container.innerHTML = '<div class="timeline-wrapper"></div>';
            const wrapper = container.querySelector('.timeline-wrapper');
            let lastDateStr = '';

            sorted.forEach((item, index) => {
                const dateObj = new Date(item.id); const dateStr = dateObj.toLocaleDateString('km-KH'); const timeStr = dateObj.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                if (dateStr !== lastDateStr) {
                    const today = new Date().toLocaleDateString('km-KH');
                    let displayLabel = dateStr === today ? "ááŸ’á„áŸƒá“áŸáŸ‡ (Today)" : dateStr;
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'sticky top-0 z-10 py-4 bg-gray-50/95 dark:bg-gray-900/95 backdrop-blur-sm -ml-6 pl-6 mb-2 border-b border-dashed border-gray-200 dark:border-gray-800';
                    headerDiv.innerHTML = `<span class="text-xs font-bold text-teal-700 dark:text-teal-400 uppercase tracking-widest"><i class="far fa-calendar-alt mr-1"></i> ${displayLabel}</span>`;
                    wrapper.appendChild(headerDiv);
                    lastDateStr = dateStr;
                }

                const f = app.calc(item);
                let amount = f.profit;
                let theme = { border: 'status-pen', dotColor: 'bg-orange-400', moneyColor: 'text-orange-500', sign: '~' };
                if (item.status === 'ordered') { theme = { border: 'status-pen', dotColor: 'bg-blue-500', moneyColor: 'text-blue-500', sign: '~' }; }
                else if (item.status === 'shipping') { theme = { border: 'status-pen', dotColor: 'bg-indigo-500', moneyColor: 'text-indigo-500', sign: '~' }; }
                else if (item.status === 'completed') { theme = { border: 'status-inc', dotColor: 'bg-emerald-500', moneyColor: 'text-emerald-600', sign: '+' }; }
                else if (item.status === 'cancelled') { theme = { border: 'status-exp', dotColor: 'bg-gray-400', moneyColor: 'text-gray-400 line-through', sign: '' }; amount = 0; }
                const delay = index * 0.05;
                const cardHtml = `<div class="history-card-modern ${theme.border}" style="animation-delay: ${delay}s" onclick="ui.openOrderModal(${item.id})"><div class="history-dot ${theme.dotColor}"></div><div class="flex justify-between items-start"><div><h4 class="font-bold text-gray-800 dark:text-gray-100 text-sm mb-0.5">${item.prodName}</h4><div class="flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400"><span class="bg-gray-100 dark:bg-gray-700 px-1.5 rounded text-[10px] font-mono">${timeStr}</span><span>â€¢ ${item.custName}</span></div></div><div class="text-right"><div class="font-bold ${theme.moneyColor} text-base">${theme.sign}$${amount.toFixed(2)}</div><div class="text-[9px] uppercase font-bold opacity-60 mt-1">${item.status}</div></div></div></div>`;
                wrapper.insertAdjacentHTML('beforeend', cardHtml);
            });
        }
        // ==========================================
        // á”á“áŸ’ááŸ‚á˜á˜á»áá„á¶áš ADDRESS POPUP á“áŸ…á‘á¸á“áŸáŸ‡
        // ==========================================

        ui.openAddressModal = function () {
            const smallInput = document.getElementById('cust-addr');
            const bigTextarea = document.getElementById('expanded-addr-text');
            const mapBtn = document.getElementById('modal-addr-map-btn');
            const address = smallInput.value;

            bigTextarea.value = address;

            const urlMatch = address ? address.match(/(https?:\/\/[^\s]+)/) : null;
            if (urlMatch && mapBtn) {
                mapBtn.href = urlMatch[0];
                mapBtn.classList.remove('hidden');
                mapBtn.classList.add('flex');
            } else if (mapBtn) {
                mapBtn.href = '#';
                mapBtn.classList.add('hidden');
                mapBtn.classList.remove('flex');
            }

            document.getElementById('modal-address-expand').classList.remove('hidden');
            setTimeout(() => { bigTextarea.focus(); }, 100);
        };

        ui.saveExpandedAddress = function () {
            // 1. á™á€á‘á·á“áŸ’á“áŸá™á–á¸á”áŸ’ášá¢á”áŸ‹á’áŸ†
            const newAddr = document.getElementById('expanded-addr-text').value;

            // 2. á”áŸ„áŸ‡ááŸ’ášá¡á”áŸ‹á‘áŸ…á”áŸ’ášá¢á”áŸ‹áá¼á…áœá·á‰
            document.getElementById('cust-addr').value = newAddr;

            // 3. á”á·á‘ Popup
            document.getElementById('modal-address-expand').classList.add('hidden');
        };
        // á”á“áŸ’ááŸ‚á˜á“áŸ…áá¶á„á€áŸ’ášáŸ… á¬á€áŸ’á“á»á„ ui object á€áŸá”á¶á“
        ui.quickViewAddress = (address) => {
            if (event) event.stopPropagation();

            const textarea = document.getElementById('expanded-addr-text');
            const mapBtn = document.getElementById('modal-addr-map-btn');

            textarea.value = address || "á˜á·á“á˜á¶á“á¢á¶áŸá™áŠáŸ’á‹á¶á“ááŸ’ášá¼áœá”á¶á“á€ááŸ‹ááŸ’ášá¶á‘áŸ";

            // áŸáŸ’áœáŸ‚á„ášá€ URL á€áŸ’á“á»á„ Address (Google Maps á¬ Link áá¶á€áŸáŠáŸ„á™)
            const urlMatch = address ? address.match(/(https?:\/\/[^\s]+)/) : null;
            if (urlMatch && mapBtn) {
                mapBtn.href = urlMatch[0];
                mapBtn.classList.remove('hidden');
                mapBtn.classList.add('flex');
            } else if (mapBtn) {
                mapBtn.href = '#';
                mapBtn.classList.add('hidden');
                mapBtn.classList.remove('flex');
            }

            document.getElementById('modal-address-expand').classList.remove('hidden');
        };
        window.onload = app.init;
        document.addEventListener('DOMContentLoaded', () => {
            const statusFilterBtn = document.getElementById('statusFilterBtn');
            const statusModal = document.getElementById('statusModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const statusOptions = document.querySelectorAll('.status-option');
            const currentStatusText = document.getElementById('currentStatusText');

            // á”á¾á€á•áŸ’á‘á¶áŸ†á„ Popup
            if (statusFilterBtn && statusModal) {
                statusFilterBtn.addEventListener('click', () => {
                    statusModal.classList.remove('hidden');
                    statusModal.classList.add('flex');
                });
            }

            // á”á·á‘á•áŸ’á‘á¶áŸ†á„ Popup (á–áŸá›á…á»á…áŸá‰áŸ’á‰á¶ááŸ’áœáŸ‚á„)
            if (closeModalBtn && statusModal) {
                closeModalBtn.addEventListener('click', () => {
                    statusModal.classList.add('hidden');
                    statusModal.classList.remove('flex');
                });
            }

            // á”á·á‘á•áŸ’á‘á¶áŸ†á„ Popup (á–áŸá›á…á»á…á•áŸ’á‘áŸƒáá¶á„á€áŸ’ášáŸ…)
            if (statusModal) {
                statusModal.addEventListener('click', (e) => {
                    if (e.target === statusModal) {
                        statusModal.classList.add('hidden');
                        statusModal.classList.remove('flex');
                    }
                });
            }

            // á–áŸá›á‡áŸ’ášá¾áŸášá¾áŸ Status áá¶á˜á½á™
            if (statusOptions && statusModal) {
                statusOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const statusValue = option.getAttribute('data-status');
                        const icon = option.querySelector('span:nth-child(1)').innerText;
                        const text = option.querySelector('span:nth-child(2)').innerText;

                        // á”áŸ’áŠá¼ášá¢á€áŸ’áŸášá›á¾á”áŸŠá¼áá»á„áá¶á„á€áŸ’ášáŸ…
                        if (currentStatusText) currentStatusText.innerText = `${icon} ${text}`;

                        // á”á·á‘ Popup
                        statusModal.classList.add('hidden');
                        statusModal.classList.remove('flex');

                        // á áŸ…á˜á»áá„á¶ášá…áŸ’ášáŸ„áŸ‡á‘á·á“áŸ’á“á“áŸá™ áŠáŸ‚á›á¢áŸ’á“á€á˜á¶á“áŸáŸ’ášá¶á”áŸ‹
                        if (typeof ui !== 'undefined' && typeof ui.filterList === 'function') {
                            ui.filterList(statusValue);
                        }
                    });
                });
            }
        });
        // ===================================================================
        // á€á¼áŠááŸ’á˜á¸áŸá˜áŸ’ášá¶á”áŸ‹á”á‰áŸ’á‡á¶ Popup Status á“áŸ…á€áŸ’á“á»á„á•áŸ’á‘á¶áŸ†á„ "á”á„áŸ’á€á¾áá€á¶ášá›á€áŸ‹ááŸ’á˜á¸/á€áŸ‚á”áŸ’ášáŸ‚"
        // ===================================================================
        document.addEventListener('DOMContentLoaded', function () {

            // á…á¶á”áŸ‹á™á€áˆáŸ’á˜áŸ„áŸ‡ ID ášá”áŸáŸ‹á€á¼áŠ HTML áŠáŸ‚á›á™á¾á„á”á¶á“á”á„áŸ’á€á¾áá“áŸ…á‡áŸ†á á¶á“á‘á¸áŸ¡ á“á·á„á‘á¸áŸ¢
            const formStatusBtn = document.getElementById('formStatusBtn');
            const formStatusModal = document.getElementById('formStatusModal');
            const closeFormStatusModalBtn = document.getElementById('closeFormStatusModalBtn');
            const formStatusItems = document.querySelectorAll('.form-status-item');
            const hiddenStatusInput = document.getElementById('status');
            const formStatusIcon = document.getElementById('formStatusIcon');
            const formStatusText = document.getElementById('formStatusText');

            // áŸ¡. á–áŸá›á…á»á…á›á¾á”áŸ’ášá¢á”áŸ‹ Status ááŸ’á˜á¸ => áœá¶á“á¹á„á”á¾á€á•áŸ’á‘á¶áŸ†á„ Popup á›áŸ„áá¡á¾á„á˜á€
            if (formStatusBtn && formStatusModal) {
                formStatusBtn.addEventListener('click', function () {
                    formStatusModal.classList.remove('hidden');
                    formStatusModal.classList.add('flex');
                });
            }

            // áŸ¢. Function áŸá˜áŸ’ášá¶á”áŸ‹á”á·á‘á•áŸ’á‘á¶áŸ†á„ Popup áœá·á‰
            function closeFormStatusModal() {
                if (formStatusModal) {
                    formStatusModal.classList.add('hidden');
                    formStatusModal.classList.remove('flex');
                }
            }

            // á–áŸá›á…á»á…áŸá‰áŸ’á‰á¶ááŸ’áœáŸ‚á„ (X) á¬á…á»á…á›á¾á•áŸ’á‘áŸƒá‘á‘áŸáá¶á„á€áŸ’ášáŸ… => á”á·á‘ Popup áœá·á‰
            if (closeFormStatusModalBtn) {
                closeFormStatusModalBtn.addEventListener('click', closeFormStatusModal);
            }
            if (formStatusModal) {
                formStatusModal.addEventListener('click', function (e) {
                    if (e.target === formStatusModal) {
                        closeFormStatusModal();
                    }
                });
            }

            // áŸ£. á–áŸá›á…á»á…á‡áŸ’ášá¾áŸášá¾áŸáŸáŸ’áá¶á“á—á¶á–áá¶á˜á½á™ (á§. á‡áŸ„á‚á‡áŸá™, ášá„áŸ‹á…á¶áŸ†, á€áŸ†á–á»á„áŠá¹á€...)
            if (formStatusItems.length > 0) {
                formStatusItems.forEach(function (item) {
                    item.addEventListener('click', function () {
                        // á‘á¶á‰á™á€áá˜áŸ’á›áŸƒ (Value), Icon á“á·á„á¢á€áŸ’áŸáš á–á¸á‡á˜áŸ’ášá¾áŸáŠáŸ‚á›á”á¶á“á…á»á…
                        const val = this.getAttribute('data-status');
                        const icon = this.getAttribute('data-icon');
                        const text = this.getAttribute('data-text');

                        // [áŸáŸ†áá¶á“áŸ‹á”áŸ†á•á»á] á›á¶á€áŸ‹á‘á·á“áŸ’á“á“áŸá™ (Value) á‘á»á€ áŠá¾á˜áŸ’á”á¸á²áŸ’á™á”áŸ’ášá–áŸá“áŸ’á’á…á¶á”áŸ‹á™á€á‘áŸ… Save á”á¶á“á’á˜áŸ’á˜áá¶
                        if (hiddenStatusInput) hiddenStatusInput.value = val;

                        // á”áŸ’áá¼ášášá¼á” Icon á“á·á„á¢á€áŸ’áŸášá“áŸ…á›á¾á•áŸ’á‘á¶áŸ†á„ Form á²áŸ’á™áƒá¾á‰áŸáŸ’á¢á¶á
                        if (formStatusIcon) formStatusIcon.innerText = icon;
                        if (formStatusText) formStatusText.innerText = text;

                        // ášá¾áŸášá½á…ášá¶á›áŸ‹á á¾á™ => á”á·á‘ Popup áœá·á‰á—áŸ’á›á¶á˜áŠáŸ„á™á˜á·á“á”á¶á…áŸ‹á…á»á… OK
                        closeFormStatusModal();
                    });
                });
            }
        });
    </script>
    <div id="modal-drilldown"
        class="fixed inset-0 bg-black/60 z-[100] hidden flex items-end sm:items-center justify-center backdrop-blur-sm">
        <div
            class="bg-white dark:bg-gray-800 w-full sm:w-[500px] h-[85vh] sm:h-auto rounded-t-3xl sm:rounded-3xl p-0 overflow-hidden shadow-2xl animate-slide-up flex flex-col">
            <div
                class="p-5 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-900/50 backdrop-blur-md sticky top-0 z-10">
                <div>
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white font-serif-kh" id="drill-title">Title
                    </h3>
                    <p class="text-xs text-gray-500" id="drill-subtitle">...</p>
                </div>
                <button onclick="document.getElementById('modal-drilldown').classList.add('hidden')"
                    class="w-8 h-8 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-500 hover:text-red-500 transition"><i
                        class="fas fa-times"></i></button>
            </div>
            <div id="drill-content" class="p-5 overflow-y-auto flex-1"></div>
            <div id="drill-footer" class="p-4 border-t border-gray-100 dark:border-gray-700 hidden">
                <button onclick="ui.generatePDFStatement()"
                    class="w-full py-3 bg-teal-600 text-white rounded-xl font-bold shadow hover:bg-teal-700 transition"><i
                        class="fas fa-print mr-2"></i> á”áŸ„áŸ‡á–á»á˜áŸ’á–á”á‰áŸ’á‡á¸á“áŸáŸ‡ (Print)</button>
            </div>
        </div>
    </div>
    <div id="modal-address-expand"
        class="fixed inset-0 bg-slate-900/60 z-[20000] hidden flex items-center justify-center backdrop-blur-[6px] p-4 transition-all duration-300">

        <div
            class="w-full max-w-md oled-glass-bg rounded-[28px] shadow-2xl overflow-hidden animate-slide-up relative border border-white/40 dark:border-white/10">

            <div
                class="absolute top-0 left-0 w-full h-40 bg-gradient-to-b from-teal-500/10 via-blue-500/5 to-transparent pointer-events-none">
            </div>

            <div class="px-6 pt-6 pb-2 flex justify-between items-start relative z-10">
                <div class="flex items-center gap-4">
                    <div
                        class="w-11 h-11 rounded-2xl bg-gradient-to-br from-teal-400 to-blue-500 shadow-lg shadow-blue-500/30 flex items-center justify-center text-white border border-white/20">
                        <i class="fas fa-map-marked-alt text-lg"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800 dark:text-white text-lg font-serif-kh tracking-wide">
                            á¢á¶áŸá™áŠáŸ’á‹á¶á“á›á˜áŸ’á¢á·á
                        </h3>
                        <p class="text-[11px] text-gray-500 dark:text-gray-400 font-sans opacity-80">
                            áŸá¼á˜á”á‰áŸ’á…á¼á›á‘á¸áá¶áŸ†á„áá¶á„á€áŸ’ášáŸ„á˜</p>
                    </div>
                </div>

                <button onclick="document.getElementById('modal-address-expand').classList.add('hidden')"
                    class="text-gray-400 hover:text-red-500 transition w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/50 dark:hover:bg-white/10">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>

            <div class="px-6 py-2 relative z-10">
                <textarea id="expanded-addr-text"
                    class="w-full h-[180px] bg-transparent border-none outline-none text-lg leading-relaxed resize-none text-gray-800 dark:text-white placeholder:text-gray-400 font-sans"
                    placeholder="á•áŸ’á‘áŸ‡á›áŸá..., á•áŸ’á›á¼áœ..., áŸá„áŸ’á€á¶ááŸ‹..., áááŸ’áŒ... (á¢á¶á… Paste á‘á¸áá¶áŸ†á„á–á¸ Google Maps á”á¶á“)"></textarea>

                <div class="w-full h-px bg-gradient-to-r from-transparent via-teal-500/30 to-transparent mt-2"></div>
            </div>

            <div class="px-6 pb-6 pt-2 flex flex-col gap-3 relative z-10">
                <a id="modal-addr-map-btn" href="#" target="_blank"
                    class="hidden w-full items-center justify-center gap-2 px-4 py-3 rounded-xl bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 border border-blue-200 dark:border-blue-700 font-bold text-sm hover:bg-blue-100 transition active:scale-95">
                    <i class="fas fa-map-marked-alt"></i> á”á¾á€ Google Maps
                </a>
                <div class="flex gap-3">
                    <button onclick="document.getElementById('modal-address-expand').classList.add('hidden')"
                        class="flex-1 py-3 rounded-xl border border-gray-200 dark:border-gray-600 text-gray-500 dark:text-gray-400 font-bold hover:bg-gray-100/50 dark:hover:bg-white/5 transition text-sm">
                        á”áŸ„áŸ‡á”á„áŸ‹
                    </button>
                    <button onclick="ui.saveExpandedAddress()"
                        class="flex-1 py-3 rounded-xl bg-gradient-to-r from-teal-600 to-blue-600 hover:from-teal-700 hover:to-blue-700 text-white font-bold shadow-lg shadow-blue-500/20 active:scale-95 transition text-sm">
                        á™á›áŸ‹á–áŸ’ášá˜
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="statusModal"
        class="fixed inset-0 z-[100] hidden items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm transition-opacity">
        <div
            class="bg-white dark:bg-slate-900 rounded-t-3xl sm:rounded-3xl shadow-2xl w-full max-w-md overflow-hidden transform transition-transform pb-4 sm:pb-0 border border-transparent dark:border-slate-700">
            <div
                class="px-6 py-4 border-b border-gray-100 dark:border-slate-800 flex justify-between items-center bg-gray-50/80 dark:bg-slate-800/80">
                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100">á‡áŸ’ášá¾áŸášá¾áŸáŸáŸ’áá¶á“á—á¶á–</h3>
                <button id="closeModalBtn"
                    class="p-1.5 bg-gray-200/60 dark:bg-slate-700/60 rounded-full text-gray-500 dark:text-gray-400 hover:bg-red-100 dark:hover:bg-red-900/30 hover:text-red-500 dark:hover:text-red-400 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <div class="p-3 space-y-1">
                <div class="status-option flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="all">
                    <span class="text-xl">ğŸ“„</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á”á„áŸ’á á¶á‰á‘á¶áŸ†á„á¢áŸáŸ‹
                        (All)</span>
                </div>
                <div class="status-option flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="pending">
                    <span class="text-xl">â³</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">ášá„áŸ‹á…á¶áŸ†
                        (Pending)</span>
                </div>
                <div class="status-option flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="ordered">
                    <span class="text-xl">ğŸ›’</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á”á¶á“á€á»á˜áŸ’á˜áŸ‰á„áŸ‹
                        (Ordered)</span>
                </div>
                <div class="status-option flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="shipping">
                    <span class="text-xl">ğŸšš</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á€áŸ†á–á»á„áŠá¹á€
                        (Shipping)</span>
                </div>
                <div class="status-option flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="completed">
                    <span class="text-xl">âœ…</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á‡áŸ„á‚á‡áŸá™
                        (Completed)</span>
                </div>
                <div class="status-option flex items-center gap-4 px-4 py-3.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="cancelled">
                    <span class="text-xl">âŒ</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á”áŸ„áŸ‡á”á„áŸ‹
                        (Cancelled)</span>
                </div>
            </div>
        </div>
    </div>
    <div id="formStatusModal"
        class="fixed inset-0 z-[10000] hidden items-end sm:items-center justify-center bg-black/40 backdrop-blur-sm transition-opacity">
        <div
            class="bg-white dark:bg-slate-900 rounded-t-3xl sm:rounded-3xl shadow-2xl w-full max-w-md overflow-hidden transform transition-transform pb-4 sm:pb-0 border border-transparent dark:border-slate-700 animate-slide-up">
            <div
                class="px-6 py-4 border-b border-gray-100 dark:border-slate-800 flex justify-between items-center bg-gray-50/80 dark:bg-slate-800/80">
                <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 font-serif-kh">á€áŸ†áááŸ‹áŸáŸ’áá¶á“á—á¶á–</h3>
                <button id="closeFormStatusModalBtn"
                    class="p-1.5 bg-gray-200/60 dark:bg-slate-700/60 rounded-full text-gray-500 dark:text-gray-400 hover:bg-red-100 hover:text-red-500 transition-colors">
                    <i class="fas fa-times w-5 h-5 flex items-center justify-center"></i>
                </button>
            </div>
            <div class="p-3 space-y-1">
                <div class="form-status-item flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="pending" data-icon="â³" data-text="ášá„áŸ‹á…á¶áŸ† (Pending)">
                    <span class="text-xl">â³</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">ášá„áŸ‹á…á¶áŸ† (Pending)</span>
                </div>
                <div class="form-status-item flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="ordered" data-icon="ğŸ›’" data-text="á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹ (Ordered)">
                    <span class="text-xl">ğŸ›’</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á”á¶á“á€á»á˜áŸ’á˜á„áŸ‹ (Ordered)</span>
                </div>
                <div class="form-status-item flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="shipping" data-icon="ğŸšš" data-text="á€áŸ†á–á»á„áŠá¹á€ (Shipping)">
                    <span class="text-xl">ğŸšš</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á€áŸ†á–á»á„áŠá¹á€ (Shipping)</span>
                </div>
                <div class="form-status-item flex items-center gap-4 px-4 py-3.5 hover:bg-teal-50 dark:hover:bg-teal-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="completed" data-icon="âœ…" data-text="á‡áŸ„á‚á‡áŸá™ (Completed)">
                    <span class="text-xl">âœ…</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á‡áŸ„á‚á‡áŸá™ (Completed)</span>
                </div>
                <div class="form-status-item flex items-center gap-4 px-4 py-3.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-2xl cursor-pointer transition-colors"
                    data-status="cancelled" data-icon="âŒ" data-text="á”áŸ„áŸ‡á”á„áŸ‹ (Cancelled)">
                    <span class="text-xl">âŒ</span><span
                        class="font-medium text-gray-700 dark:text-gray-300 text-[16px]">á”áŸ„áŸ‡á”á„áŸ‹ (Cancelled)</span>
                </div>
            </div>
        </div>
    </div>
</body>

</html>